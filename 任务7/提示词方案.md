# ä»»åŠ¡7ï¼šä¸šåŠ¡é€»è¾‘å±‚åŠæ¥å£å±‚å¼€å‘ - æç¤ºè¯æ–¹æ¡ˆ

## ğŸ“‹ æ–¹æ¡ˆè¯´æ˜

**åˆ¶å®šåŸåˆ™**ï¼š
- ä¸€è½®æç¤ºè¯å®Œæˆä¸€ä¸ªå®Œæ•´ä»»åŠ¡ï¼Œä»»åŠ¡é‡é€‚ä¸­ä½†ä¸å¯åˆ†å‰²
- æ¯è½®æç¤ºè¯åé™„åŠ æ£€æŸ¥æç¤ºè¯ï¼Œç¡®ä¿ä»»åŠ¡æˆæœè´¨é‡
- æ˜ç¡®æ–‡ä»¶åˆ†åŒºå’Œå…·ä½“å®ç°è¦æ±‚
- è¯¦ç»†çš„ä»»åŠ¡æ­¥éª¤æè¿°ï¼Œç¡®ä¿æ‰§è¡Œæ¸…æ™°

**æŠ€æœ¯æ ˆ**ï¼šFastAPI + SQLAlchemy 2.0+ + JWT + pytest
**æ€»è½®æ¬¡**ï¼š10è½®ä¸»è¦æç¤ºè¯ + 10è½®æ£€æŸ¥æç¤ºè¯

**ä½¿ç”¨è¯´æ˜**ï¼š
- æ¯ä¸ª"ğŸ¯ ç¬¬Xè½®æç¤ºè¯"æ¡†å†…çš„å†…å®¹ä¸ºä¸€æ¬¡å®Œæ•´çš„æç¤ºè¯ï¼Œå¯ç›´æ¥å¤åˆ¶ä½¿ç”¨
- æ¯ä¸ª"ğŸ” ç¬¬Xè½®æ£€æŸ¥æç¤ºè¯"æ¡†å†…çš„å†…å®¹ä¸ºå¯¹åº”çš„æ£€æŸ¥æç¤ºè¯ï¼Œç”¨äºéªŒè¯ä»»åŠ¡å®Œæˆè´¨é‡
- å»ºè®®ä¸¥æ ¼æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸è¦è·³è·ƒæˆ–åˆå¹¶è½®æ¬¡

---

## ğŸ“… æç¤ºè¯è½®æ¬¡æ¦‚è§ˆ

| è½®æ¬¡ | ä¸»è¦ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | æ–‡ä»¶åˆ†åŒº |
|------|----------|----------|----------|
| ç¬¬1è½® | ç¯å¢ƒå‡†å¤‡ä¸åŸºç¡€æ¶æ„ | 0.5å¤© | ç›®å½•ç»“æ„ã€ä¾èµ–é…ç½®ã€åŸºç¡€æ–‡ä»¶ |
| ç¬¬2è½® | åŸºç¡€æœåŠ¡ç±»å¼€å‘ | 0.5å¤© | services/base_service.py |
| ç¬¬3è½® | ç”¨æˆ·ä¸šåŠ¡æœåŠ¡å¼€å‘ | 0.5å¤© | services/user_service.py |
| ç¬¬4è½® | è§’è‰²ä¸šåŠ¡æœåŠ¡å¼€å‘ | 0.5å¤© | services/role_service.py |
| ç¬¬5è½® | æƒé™ä¸šåŠ¡æœåŠ¡å¼€å‘ | 0.5å¤© | services/permission_service.py |
| ç¬¬6è½® | è®¤è¯ä¸šåŠ¡æœåŠ¡å¼€å‘ | 0.5å¤© | services/auth_service.py |
| ç¬¬7è½® | FastAPIåº”ç”¨åŸºç¡€å¼€å‘ | 0.5å¤© | api/app.py |
| ç¬¬8è½® | æ•°æ®æ¨¡å¼å®šä¹‰å¼€å‘ | 0.5å¤© | api/schemas/ |
| ç¬¬9è½® | è®¤è¯ä¸­é—´ä»¶å¼€å‘ | 0.5å¤© | api/middleware/auth_middleware.py |
| ç¬¬10è½® | APIæ§åˆ¶å™¨å¼€å‘ | 1å¤© | api/controllers/ |

---

## ğŸ¯ ç¬¬1è½®æç¤ºè¯ï¼šç¯å¢ƒå‡†å¤‡ä¸åŸºç¡€æ¶æ„

```
è¯·å¸®æˆ‘å®ŒæˆRBACæƒé™ç³»ç»Ÿçš„ç¯å¢ƒå‡†å¤‡å’ŒåŸºç¡€æ¶æ„æ­å»ºã€‚å…·ä½“è¦æ±‚ï¼š

1. **ä¾èµ–åŒ…å®‰è£…å’Œé…ç½®**ï¼š
   - å®‰è£…FastAPIã€uvicornã€python-joseã€python-multipartã€pydantic
   - æ›´æ–°requirements.txtæ–‡ä»¶ï¼Œæ·»åŠ æ–°å¢ä¾èµ–åŒ…åŠç‰ˆæœ¬å·
   - éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ

2. **ç›®å½•ç»“æ„åˆ›å»º**ï¼š
   åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä»¥ä¸‹ç›®å½•ç»“æ„ï¼š
   ```
   services/                    # ä¸šåŠ¡é€»è¾‘å±‚
   â”œâ”€â”€ __init__.py
   â”œâ”€â”€ exceptions/              # ä¸šåŠ¡å¼‚å¸¸
   â”‚   â””â”€â”€ __init__.py
   
   api/                         # æ¥å£å±‚
   â”œâ”€â”€ __init__.py
   â”œâ”€â”€ controllers/             # æ§åˆ¶å™¨
   â”‚   â””â”€â”€ __init__.py
   â”œâ”€â”€ middleware/              # ä¸­é—´ä»¶
   â”‚   â””â”€â”€ __init__.py
   â””â”€â”€ schemas/                 # æ•°æ®æ¨¡å¼
       â””â”€â”€ __init__.py
   ```

3. **åŸºç¡€é…ç½®æ–‡ä»¶åˆ›å»º**ï¼š
   - åœ¨config/ç›®å½•ä¸‹åˆ›å»ºapi_config.pyï¼ˆAPIåŸºç¡€é…ç½®ï¼‰
   - åœ¨config/ç›®å½•ä¸‹åˆ›å»ºjwt_config.pyï¼ˆJWTè®¤è¯é…ç½®ï¼‰
   - é…ç½®æ–‡ä»¶åº”åŒ…å«å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„åŒºåˆ†

4. **éªŒè¯ç°æœ‰åŸºç¡€**ï¼š
   - éªŒè¯DAOå±‚ã€æ¨¡å‹å±‚ã€å·¥å…·å±‚æ˜¯å¦æ­£å¸¸å·¥ä½œ
   - è¿è¡Œç°æœ‰æµ‹è¯•ç¡®ä¿åŸºç¡€åŠŸèƒ½æ­£å¸¸
   - ç¡®è®¤æ•°æ®åº“è¿æ¥æ­£å¸¸

è¯·ç¡®ä¿æ‰€æœ‰æ–‡ä»¶éƒ½æœ‰é€‚å½“çš„åˆå§‹åŒ–å†…å®¹å’Œæ³¨é‡Šè¯´æ˜ã€‚
```

---

## ğŸ” ç¬¬1è½®æ£€æŸ¥æç¤ºè¯

```
è¯·æ£€æŸ¥ç¬¬ä¸€è½®ä»»åŠ¡çš„å®Œæˆæƒ…å†µï¼š

1. **ä¾èµ–åŒ…æ£€æŸ¥**ï¼š
   - éªŒè¯requirements.txtæ˜¯å¦æ­£ç¡®æ›´æ–°
   - å°è¯•å¯¼å…¥æ–°å®‰è£…çš„åŒ…ï¼šfastapi, uvicorn, jose, pydantic
   - æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§

2. **ç›®å½•ç»“æ„æ£€æŸ¥**ï¼š
   - ç¡®è®¤services/å’Œapi/ç›®å½•åŠå­ç›®å½•æ˜¯å¦æ­£ç¡®åˆ›å»º
   - éªŒè¯æ‰€æœ‰__init__.pyæ–‡ä»¶æ˜¯å¦å­˜åœ¨
   - æ£€æŸ¥ç›®å½•æƒé™æ˜¯å¦æ­£ç¡®

3. **é…ç½®æ–‡ä»¶æ£€æŸ¥**ï¼š
   - éªŒè¯config/api_config.pyå’Œjwt_config.pyæ˜¯å¦åˆ›å»º
   - æ£€æŸ¥é…ç½®æ–‡ä»¶å†…å®¹æ˜¯å¦åˆç†
   - ç¡®è®¤ç¯å¢ƒå˜é‡é…ç½®æ˜¯å¦æ­£ç¡®

4. **åŸºç¡€åŠŸèƒ½éªŒè¯**ï¼š
   - è¿è¡Œï¼špython -c "from dao.user_dao import UserDao; print('DAOå±‚æ­£å¸¸')"
   - è¿è¡Œï¼špython -c "from utils.password_utils import PasswordUtils; print('å·¥å…·å±‚æ­£å¸¸')"
   - æ‰§è¡Œç°æœ‰æµ‹è¯•ï¼špython -m pytest tests/ -v

å¦‚æœå‘ç°ä»»ä½•é—®é¢˜ï¼Œè¯·ç«‹å³ä¿®å¤å¹¶é‡æ–°éªŒè¯ã€‚
```

---

## ğŸ¯ ç¬¬2è½®æç¤ºè¯ï¼šåŸºç¡€æœåŠ¡ç±»å¼€å‘

```
è¯·å¼€å‘RBACç³»ç»Ÿçš„åŸºç¡€æœåŠ¡ç±»ï¼Œä½œä¸ºæ‰€æœ‰ä¸šåŠ¡æœåŠ¡çš„çˆ¶ç±»ã€‚å…·ä½“è¦æ±‚ï¼š

1. **æ–‡ä»¶ä½ç½®**ï¼šservices/base_service.py

2. **æ ¸å¿ƒåŠŸèƒ½å®ç°**ï¼š
   ```python
   class BaseService:
       # æ•°æ®åº“ä¼šè¯ç®¡ç†
       - åˆå§‹åŒ–æ•°æ®åº“ä¼šè¯
       - ä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†
       - è‡ªåŠ¨æäº¤å’Œå›æ»šæœºåˆ¶
       
       # ç»Ÿä¸€å¼‚å¸¸å¤„ç†
       - é›†æˆç°æœ‰çš„DatabaseErrorã€NotFoundErrorç­‰å¼‚å¸¸ç±»
       - ä¸šåŠ¡å¼‚å¸¸çš„ç»Ÿä¸€å¤„ç†å’Œè½¬æ¢
       - å¼‚å¸¸æ—¥å¿—è®°å½•
       
       # äº‹åŠ¡ç®¡ç†å°è£…
       - äº‹åŠ¡å¼€å§‹ã€æäº¤ã€å›æ»šçš„å°è£…æ–¹æ³•
       - æ”¯æŒåµŒå¥—äº‹åŠ¡
       - äº‹åŠ¡å¤±è´¥çš„è‡ªåŠ¨å›æ»š
       
       # æ—¥å¿—è®°å½•åŠŸèƒ½
       - é›†æˆç°æœ‰çš„colorlogæ—¥å¿—ç³»ç»Ÿ
       - ä¸šåŠ¡æ“ä½œæ—¥å¿—è®°å½•
       - æ€§èƒ½ç›‘æ§æ—¥å¿—
   ```

3. **é›†æˆç°æœ‰ç»„ä»¶**ï¼š
   - ä½¿ç”¨ç°æœ‰çš„models/base_model.pyä¸­çš„æ•°æ®åº“é…ç½®
   - é›†æˆdao/base_dao.pyä¸­çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
   - ä½¿ç”¨ç°æœ‰çš„æ—¥å¿—é…ç½®

4. **è®¾è®¡è¦æ±‚**ï¼š
   - ä½¿ç”¨æŠ½è±¡åŸºç±»è®¾è®¡ï¼Œå®šä¹‰æœåŠ¡å±‚æ¥å£è§„èŒƒ
   - æä¾›å®Œæ•´çš„ç±»å‹æ³¨è§£
   - ç¼–å†™è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²
   - å®ç°ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ”¯æŒï¼ˆwithè¯­å¥ï¼‰

5. **å¼‚å¸¸å¤„ç†ç±»æ‰©å±•**ï¼š
   åœ¨services/exceptions/ç›®å½•ä¸‹åˆ›å»ºä¸šåŠ¡å¼‚å¸¸ç±»ï¼š
   - BusinessLogicErrorï¼ˆä¸šåŠ¡é€»è¾‘å¼‚å¸¸ï¼‰
   - AuthenticationErrorï¼ˆè®¤è¯å¼‚å¸¸ï¼‰
   - AuthorizationErrorï¼ˆæˆæƒå¼‚å¸¸ï¼‰
   - ValidationErrorï¼ˆæ•°æ®éªŒè¯å¼‚å¸¸ï¼‰

è¯·ç¡®ä¿ä»£ç è´¨é‡é«˜ï¼Œéµå¾ªPEP 8è§„èŒƒï¼Œå¹¶æä¾›ä½¿ç”¨ç¤ºä¾‹ã€‚
```

---

## ğŸ” ç¬¬2è½®æ£€æŸ¥æç¤ºè¯

```
è¯·æ£€æŸ¥åŸºç¡€æœåŠ¡ç±»çš„å¼€å‘è´¨é‡ï¼š

1. **ä»£ç ç»“æ„æ£€æŸ¥**ï¼š
   - éªŒè¯BaseServiceç±»æ˜¯å¦æ­£ç¡®å®ç°
   - æ£€æŸ¥æ˜¯å¦æ­£ç¡®ç»§æ‰¿å’Œä½¿ç”¨æŠ½è±¡åŸºç±»
   - ç¡®è®¤ç±»å‹æ³¨è§£æ˜¯å¦å®Œæ•´

2. **åŠŸèƒ½å®Œæ•´æ€§æ£€æŸ¥**ï¼š
   - æµ‹è¯•æ•°æ®åº“ä¼šè¯ç®¡ç†åŠŸèƒ½
   - éªŒè¯å¼‚å¸¸å¤„ç†æœºåˆ¶æ˜¯å¦æ­£å¸¸å·¥ä½œ
   - æ£€æŸ¥äº‹åŠ¡ç®¡ç†æ˜¯å¦æ­£ç¡®å®ç°
   - æµ‹è¯•æ—¥å¿—è®°å½•åŠŸèƒ½

3. **é›†æˆæµ‹è¯•**ï¼š
   - éªŒè¯ä¸ç°æœ‰DAOå±‚çš„é›†æˆ
   - æµ‹è¯•ä¸ç°æœ‰å¼‚å¸¸å¤„ç†çš„å…¼å®¹æ€§
   - æ£€æŸ¥æ—¥å¿—ç³»ç»Ÿé›†æˆæ˜¯å¦æ­£å¸¸

4. **ä»£ç è´¨é‡æ£€æŸ¥**ï¼š
   - è¿è¡Œpylintæˆ–flake8æ£€æŸ¥ä»£ç è§„èŒƒ
   - éªŒè¯æ–‡æ¡£å­—ç¬¦ä¸²æ˜¯å¦å®Œæ•´
   - æ£€æŸ¥æ˜¯å¦æœ‰æ½œåœ¨çš„å®‰å…¨é—®é¢˜

5. **å¼‚å¸¸ç±»æ£€æŸ¥**ï¼š
   - éªŒè¯services/exceptions/ç›®å½•ä¸‹çš„å¼‚å¸¸ç±»
   - æµ‹è¯•å¼‚å¸¸ç»§æ‰¿å…³ç³»æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥å¼‚å¸¸ä¿¡æ¯æ˜¯å¦æ¸…æ™°

å¦‚æœå‘ç°é—®é¢˜ï¼Œè¯·ä¿®å¤å¹¶é‡æ–°æµ‹è¯•ã€‚
```

---

## ğŸ¯ ç¬¬3è½®æç¤ºè¯ï¼šç”¨æˆ·ä¸šåŠ¡æœåŠ¡å¼€å‘

```
è¯·å¼€å‘ç”¨æˆ·ä¸šåŠ¡æœåŠ¡ç±»ï¼Œå°è£…ç”¨æˆ·ç›¸å…³çš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ã€‚å…·ä½“è¦æ±‚ï¼š

1. **æ–‡ä»¶ä½ç½®**ï¼šservices/user_service.py

2. **ç±»è®¾è®¡**ï¼š
   ```python
   class UserService(BaseService):
       def __init__(self, session):
           # åˆå§‹åŒ–UserDaoã€PasswordUtilsç­‰ç»„ä»¶
           
       # æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•
       async def create_user(self, username: str, email: str, password: str, **kwargs) -> User:
           # ç”¨æˆ·æ³¨å†Œé€»è¾‘ï¼šæ•°æ®éªŒè¯ã€å¯†ç åŠ å¯†ã€ç”¨æˆ·åˆ›å»º
           
       async def authenticate_user(self, username: str, password: str) -> Optional[User]:
           # ç”¨æˆ·è®¤è¯ï¼šç”¨æˆ·å/é‚®ç®±ç™»å½•ã€å¯†ç éªŒè¯ã€çŠ¶æ€æ£€æŸ¥
           
       async def update_user(self, user_id: int, **update_data) -> User:
           # æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼šæ•°æ®éªŒè¯ã€æƒé™æ£€æŸ¥ã€æ›´æ–°æ“ä½œ
           
       async def change_password(self, user_id: int, old_password: str, new_password: str) -> bool:
           # ä¿®æ”¹å¯†ç ï¼šæ—§å¯†ç éªŒè¯ã€æ–°å¯†ç å¼ºåº¦æ£€æŸ¥ã€å¯†ç æ›´æ–°
           
       async def get_user_permissions(self, user_id: int) -> List[str]:
           # è·å–ç”¨æˆ·æƒé™ï¼šé€šè¿‡è§’è‰²è·å–æƒé™åˆ—è¡¨
           
       async def enable_user(self, user_id: int) -> bool:
           # å¯ç”¨ç”¨æˆ·ï¼šçŠ¶æ€æ›´æ–°ã€æ—¥å¿—è®°å½•
           
       async def disable_user(self, user_id: int) -> bool:
           # ç¦ç”¨ç”¨æˆ·ï¼šçŠ¶æ€æ›´æ–°ã€ä¼šè¯æ¸…ç†ã€æ—¥å¿—è®°å½•
   ```

3. **é›†æˆç°æœ‰ç»„ä»¶**ï¼š
   - ä½¿ç”¨UserDaoçš„13ä¸ªä¸“ç”¨æ–¹æ³•
   - é›†æˆPasswordUtilsè¿›è¡Œå¯†ç å¤„ç†
   - ä½¿ç”¨Useræ¨¡å‹çš„éªŒè¯æ–¹æ³•
   - é›†æˆç°æœ‰çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

4. **ä¸šåŠ¡é€»è¾‘è¦æ±‚**ï¼š
   - ç”¨æˆ·åå’Œé‚®ç®±å”¯ä¸€æ€§æ£€æŸ¥
   - å¯†ç å¼ºåº¦éªŒè¯å’ŒåŠ å¯†å­˜å‚¨
   - ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼ˆå¯ç”¨/ç¦ç”¨/é”å®šï¼‰
   - æƒé™æ£€æŸ¥å’ŒæˆæƒéªŒè¯
   - å®Œæ•´çš„å®¡è®¡æ—¥å¿—è®°å½•

5. **æ•°æ®éªŒè¯**ï¼š
   - ç”¨æˆ·åæ ¼å¼éªŒè¯ï¼ˆ3-50å­—ç¬¦ï¼Œå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼‰
   - é‚®ç®±æ ¼å¼éªŒè¯
   - å¯†ç å¼ºåº¦éªŒè¯ï¼ˆ8-128å­—ç¬¦ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
   - è¾“å…¥æ•°æ®çš„SQLæ³¨å…¥é˜²æŠ¤

6. **å¼‚å¸¸å¤„ç†**ï¼š
   - ç”¨æˆ·ä¸å­˜åœ¨å¼‚å¸¸
   - ç”¨æˆ·å/é‚®ç®±é‡å¤å¼‚å¸¸
   - å¯†ç éªŒè¯å¤±è´¥å¼‚å¸¸
   - ç”¨æˆ·çŠ¶æ€å¼‚å¸¸ï¼ˆå·²ç¦ç”¨ã€å·²é”å®šï¼‰

è¯·ç¡®ä¿æ‰€æœ‰æ–¹æ³•éƒ½æœ‰å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ã€‚
```

---

## ğŸ” ç¬¬3è½®æ£€æŸ¥æç¤ºè¯

```
è¯·å…¨é¢æ£€æŸ¥ç”¨æˆ·ä¸šåŠ¡æœåŠ¡çš„å®ç°è´¨é‡ï¼š

1. **åŠŸèƒ½å®Œæ•´æ€§æµ‹è¯•**ï¼š
   - æµ‹è¯•ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ï¼šcreate_useræ–¹æ³•
   - æµ‹è¯•ç”¨æˆ·è®¤è¯åŠŸèƒ½ï¼šauthenticate_useræ–¹æ³•
   - æµ‹è¯•ç”¨æˆ·ä¿¡æ¯æ›´æ–°ï¼šupdate_useræ–¹æ³•
   - æµ‹è¯•å¯†ç ä¿®æ”¹åŠŸèƒ½ï¼šchange_passwordæ–¹æ³•
   - æµ‹è¯•æƒé™è·å–åŠŸèƒ½ï¼šget_user_permissionsæ–¹æ³•
   - æµ‹è¯•ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼šenable_userå’Œdisable_useræ–¹æ³•

2. **æ•°æ®éªŒè¯æµ‹è¯•**ï¼š
   - æµ‹è¯•ç”¨æˆ·åæ ¼å¼éªŒè¯ï¼ˆæ­£å¸¸ã€å¼‚å¸¸æƒ…å†µï¼‰
   - æµ‹è¯•é‚®ç®±æ ¼å¼éªŒè¯ï¼ˆæ­£å¸¸ã€å¼‚å¸¸æƒ…å†µï¼‰
   - æµ‹è¯•å¯†ç å¼ºåº¦éªŒè¯ï¼ˆå„ç§å¼ºåº¦çº§åˆ«ï¼‰
   - æµ‹è¯•å”¯ä¸€æ€§çº¦æŸæ£€æŸ¥

3. **å®‰å…¨æ€§æ£€æŸ¥**ï¼š
   - éªŒè¯å¯†ç æ˜¯å¦æ­£ç¡®åŠ å¯†å­˜å‚¨
   - æ£€æŸ¥æ˜¯å¦å­˜åœ¨SQLæ³¨å…¥é£é™©
   - éªŒè¯æ•æ„Ÿä¿¡æ¯æ˜¯å¦æ­£ç¡®å¤„ç†
   - æ£€æŸ¥æƒé™éªŒè¯æ˜¯å¦åˆ°ä½

4. **é›†æˆæµ‹è¯•**ï¼š
   - æµ‹è¯•ä¸UserDaoçš„é›†æˆ
   - æµ‹è¯•ä¸PasswordUtilsçš„é›†æˆ
   - æµ‹è¯•ä¸Useræ¨¡å‹çš„é›†æˆ
   - éªŒè¯å¼‚å¸¸å¤„ç†æ˜¯å¦æ­£ç¡®

5. **æ€§èƒ½æµ‹è¯•**ï¼š
   - æµ‹è¯•æ‰¹é‡ç”¨æˆ·æ“ä½œæ€§èƒ½
   - æ£€æŸ¥æ•°æ®åº“æŸ¥è¯¢æ•ˆç‡
   - éªŒè¯å†…å­˜ä½¿ç”¨æ˜¯å¦åˆç†

6. **æ—¥å¿—å’Œå®¡è®¡**ï¼š
   - æ£€æŸ¥å…³é”®æ“ä½œæ˜¯å¦æœ‰æ—¥å¿—è®°å½•
   - éªŒè¯å®¡è®¡ä¿¡æ¯æ˜¯å¦å®Œæ•´
   - æµ‹è¯•å¼‚å¸¸æƒ…å†µçš„æ—¥å¿—è®°å½•

å¦‚æœå‘ç°ä»»ä½•é—®é¢˜ï¼Œè¯·ç«‹å³ä¿®å¤å¹¶é‡æ–°æµ‹è¯•ã€‚
```

---

## ğŸ¯ ç¬¬4è½®æç¤ºè¯ï¼šè§’è‰²ä¸šåŠ¡æœåŠ¡å¼€å‘

```
è¯·å¼€å‘è§’è‰²ä¸šåŠ¡æœåŠ¡ç±»ï¼Œç®¡ç†è§’è‰²ç›¸å…³çš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ã€‚å…·ä½“è¦æ±‚ï¼š

1. **æ–‡ä»¶ä½ç½®**ï¼šservices/role_service.py

2. **ç±»è®¾è®¡**ï¼š
   ```python
   class RoleService(BaseService):
       def __init__(self, session):
           # åˆå§‹åŒ–RoleDaoã€RolePermissionDaoç­‰ç»„ä»¶
           
       # æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•
       async def create_role(self, role_name: str, role_code: str, description: str = None) -> Role:
           # è§’è‰²åˆ›å»ºï¼šæ•°æ®éªŒè¯ã€å”¯ä¸€æ€§æ£€æŸ¥ã€è§’è‰²åˆ›å»º
           
       async def update_role(self, role_id: int, **update_data) -> Role:
           # è§’è‰²æ›´æ–°ï¼šæ•°æ®éªŒè¯ã€æƒé™æ£€æŸ¥ã€æ›´æ–°æ“ä½œ
           
       async def delete_role(self, role_id: int) -> bool:
           # è§’è‰²åˆ é™¤ï¼šä¾èµ–æ£€æŸ¥ã€çº§è”å¤„ç†ã€åˆ é™¤æ“ä½œ
           
       async def assign_permissions(self, role_id: int, permission_ids: List[int]) -> bool:
           # æƒé™åˆ†é…ï¼šæƒé™éªŒè¯ã€æ‰¹é‡åˆ†é…ã€å…³ç³»ç®¡ç†
           
       async def revoke_permissions(self, role_id: int, permission_ids: List[int]) -> bool:
           # æƒé™æ’¤é”€ï¼šå…³ç³»æ£€æŸ¥ã€æ‰¹é‡æ’¤é”€ã€çŠ¶æ€æ›´æ–°
           
       async def get_role_users(self, role_id: int, page: int = 1, size: int = 20) -> Dict:
           # è·å–è§’è‰²ç”¨æˆ·ï¼šåˆ†é¡µæŸ¥è¯¢ã€ç”¨æˆ·ä¿¡æ¯ã€ç»Ÿè®¡æ•°æ®
           
       async def get_role_permissions(self, role_id: int) -> List[Permission]:
           # è·å–è§’è‰²æƒé™ï¼šæƒé™åˆ—è¡¨ã€æƒé™æ ‘ç»“æ„
           
       async def assign_users(self, role_id: int, user_ids: List[int]) -> bool:
           # ç”¨æˆ·åˆ†é…ï¼šç”¨æˆ·éªŒè¯ã€æ‰¹é‡åˆ†é…ã€å…³ç³»ç®¡ç†
   ```

3. **é›†æˆç°æœ‰ç»„ä»¶**ï¼š
   - ä½¿ç”¨RoleDaoçš„13ä¸ªä¸“ç”¨æ–¹æ³•
   - ä½¿ç”¨RolePermissionDaoè¿›è¡Œå…³è”æ“ä½œ
   - ä½¿ç”¨UserRoleDaoè¿›è¡Œç”¨æˆ·è§’è‰²ç®¡ç†
   - é›†æˆRoleæ¨¡å‹çš„éªŒè¯æ–¹æ³•

4. **ä¸šåŠ¡é€»è¾‘è¦æ±‚**ï¼š
   - è§’è‰²åç§°å’Œä»£ç å”¯ä¸€æ€§æ£€æŸ¥
   - è§’è‰²ä»£ç æ ¼å¼éªŒè¯ï¼ˆå¤§å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼‰
   - æƒé™åˆ†é…çš„åˆç†æ€§æ£€æŸ¥
   - è§’è‰²åˆ é™¤å‰çš„ä¾èµ–å…³ç³»æ£€æŸ¥
   - ç”¨æˆ·è§’è‰²åˆ†é…çš„æƒé™éªŒè¯

5. **æ•°æ®éªŒè¯**ï¼š
   - è§’è‰²åç§°æ ¼å¼éªŒè¯ï¼ˆ2-100å­—ç¬¦ï¼‰
   - è§’è‰²ä»£ç æ ¼å¼éªŒè¯ï¼ˆROLE_XXXæ ¼å¼ï¼‰
   - æƒé™IDæœ‰æ•ˆæ€§éªŒè¯
   - ç”¨æˆ·IDæœ‰æ•ˆæ€§éªŒè¯

6. **çº§è”æ“ä½œå¤„ç†**ï¼š
   - è§’è‰²åˆ é™¤æ—¶å¤„ç†ç”¨æˆ·è§’è‰²å…³è”
   - è§’è‰²åˆ é™¤æ—¶å¤„ç†è§’è‰²æƒé™å…³è”
   - æƒé™å˜æ›´æ—¶çš„å½±å“åˆ†æ
   - æ‰¹é‡æ“ä½œçš„äº‹åŠ¡å¤„ç†

7. **æƒé™ç®¡ç†**ï¼š
   - æƒé™åˆ†é…çš„å±‚çº§æ£€æŸ¥
   - æƒé™å†²çªæ£€æµ‹
   - æƒé™ç»§æ‰¿å…³ç³»å¤„ç†
   - æƒé™èŒƒå›´éªŒè¯

è¯·ç¡®ä¿æ‰€æœ‰æ“ä½œéƒ½æœ‰å®Œæ•´çš„äº‹åŠ¡æ”¯æŒå’Œå›æ»šæœºåˆ¶ã€‚
```

---

## ğŸ” ç¬¬4è½®æ£€æŸ¥æç¤ºè¯

```
è¯·å…¨é¢æ£€æŸ¥è§’è‰²ä¸šåŠ¡æœåŠ¡çš„å®ç°è´¨é‡ï¼š

1. **æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•**ï¼š
   - æµ‹è¯•è§’è‰²åˆ›å»ºï¼šcreate_roleæ–¹æ³•ï¼ˆæ­£å¸¸å’Œå¼‚å¸¸æƒ…å†µï¼‰
   - æµ‹è¯•è§’è‰²æ›´æ–°ï¼šupdate_roleæ–¹æ³•
   - æµ‹è¯•è§’è‰²åˆ é™¤ï¼šdelete_roleæ–¹æ³•ï¼ˆåŒ…æ‹¬çº§è”å¤„ç†ï¼‰
   - æµ‹è¯•æƒé™åˆ†é…ï¼šassign_permissionsæ–¹æ³•
   - æµ‹è¯•æƒé™æ’¤é”€ï¼šrevoke_permissionsæ–¹æ³•
   - æµ‹è¯•ç”¨æˆ·æŸ¥è¯¢ï¼šget_role_usersæ–¹æ³•ï¼ˆåŒ…æ‹¬åˆ†é¡µï¼‰
   - æµ‹è¯•æƒé™æŸ¥è¯¢ï¼šget_role_permissionsæ–¹æ³•

2. **æ•°æ®éªŒè¯æµ‹è¯•**ï¼š
   - æµ‹è¯•è§’è‰²åç§°éªŒè¯ï¼ˆé•¿åº¦ã€æ ¼å¼ã€å”¯ä¸€æ€§ï¼‰
   - æµ‹è¯•è§’è‰²ä»£ç éªŒè¯ï¼ˆæ ¼å¼ã€å”¯ä¸€æ€§ï¼‰
   - æµ‹è¯•æƒé™IDæœ‰æ•ˆæ€§éªŒè¯
   - æµ‹è¯•ç”¨æˆ·IDæœ‰æ•ˆæ€§éªŒè¯

3. **ä¸šåŠ¡é€»è¾‘æµ‹è¯•**ï¼š
   - æµ‹è¯•è§’è‰²åˆ é™¤å‰çš„ä¾èµ–æ£€æŸ¥
   - æµ‹è¯•æƒé™åˆ†é…çš„åˆç†æ€§æ£€æŸ¥
   - æµ‹è¯•æ‰¹é‡æ“ä½œçš„äº‹åŠ¡å¤„ç†
   - æµ‹è¯•æƒé™å†²çªæ£€æµ‹

4. **é›†æˆæµ‹è¯•**ï¼š
   - æµ‹è¯•ä¸RoleDaoçš„é›†æˆ
   - æµ‹è¯•ä¸RolePermissionDaoçš„é›†æˆ
   - æµ‹è¯•ä¸UserRoleDaoçš„é›†æˆ
   - éªŒè¯æ¨¡å‹éªŒè¯æ–¹æ³•çš„é›†æˆ

5. **æ€§èƒ½å’Œå®‰å…¨æµ‹è¯•**ï¼š
   - æµ‹è¯•æ‰¹é‡æƒé™åˆ†é…æ€§èƒ½
   - æµ‹è¯•å¤§é‡ç”¨æˆ·è§’è‰²æŸ¥è¯¢æ€§èƒ½
   - æ£€æŸ¥SQLæ³¨å…¥é˜²æŠ¤
   - éªŒè¯æƒé™éªŒè¯æœºåˆ¶

6. **å¼‚å¸¸å¤„ç†æµ‹è¯•**ï¼š
   - æµ‹è¯•è§’è‰²ä¸å­˜åœ¨å¼‚å¸¸
   - æµ‹è¯•æƒé™ä¸å­˜åœ¨å¼‚å¸¸
   - æµ‹è¯•ä¾èµ–å…³ç³»å†²çªå¼‚å¸¸
   - æµ‹è¯•äº‹åŠ¡å›æ»šæœºåˆ¶

å¦‚æœå‘ç°é—®é¢˜ï¼Œè¯·ä¿®å¤å¹¶é‡æ–°éªŒè¯æ‰€æœ‰åŠŸèƒ½ã€‚
```

---

## ğŸ¯ ç¬¬5è½®æç¤ºè¯ï¼šæƒé™ä¸šåŠ¡æœåŠ¡å¼€å‘

```
è¯·å¼€å‘æƒé™ä¸šåŠ¡æœåŠ¡ç±»ï¼Œç®¡ç†æƒé™ç›¸å…³çš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ã€‚å…·ä½“è¦æ±‚ï¼š

1. **æ–‡ä»¶ä½ç½®**ï¼šservices/permission_service.py

2. **ç±»è®¾è®¡**ï¼š
   ```python
   class PermissionService(BaseService):
       def __init__(self, session):
           # åˆå§‹åŒ–PermissionDaoã€RolePermissionDaoç­‰ç»„ä»¶
           
       # æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•
       async def create_permission(self, name: str, code: str, resource_type: str, 
                                 action_type: str, description: str = None) -> Permission:
           # æƒé™åˆ›å»ºï¼šæ•°æ®éªŒè¯ã€ä»£ç æ ¼å¼æ£€æŸ¥ã€æƒé™åˆ›å»º
           
       async def update_permission(self, permission_id: int, **update_data) -> Permission:
           # æƒé™æ›´æ–°ï¼šæ•°æ®éªŒè¯ã€å½±å“åˆ†æã€æ›´æ–°æ“ä½œ
           
       async def delete_permission(self, permission_id: int) -> bool:
           # æƒé™åˆ é™¤ï¼šä¾èµ–æ£€æŸ¥ã€çº§è”å¤„ç†ã€åˆ é™¤æ“ä½œ
           
       async def get_permission_tree(self, resource_type: str = None) -> Dict:
           # æƒé™æ ‘æ„å»ºï¼šæŒ‰èµ„æºç±»å‹åˆ†ç»„ã€å±‚çº§ç»“æ„ã€æ ‘å½¢æ•°æ®
           
       async def check_permission(self, user_id: int, permission_code: str) -> bool:
           # æƒé™æ£€æŸ¥ï¼šç”¨æˆ·æƒé™éªŒè¯ã€æƒé™ç»§æ‰¿ã€ç¼“å­˜æœºåˆ¶
           
       async def get_resource_permissions(self, resource_type: str) -> List[Permission]:
           # èµ„æºæƒé™ï¼šæŒ‰èµ„æºç±»å‹è·å–æƒé™åˆ—è¡¨
           
       async def get_permission_roles(self, permission_id: int) -> List[Role]:
           # æƒé™è§’è‰²ï¼šè·å–æ‹¥æœ‰è¯¥æƒé™çš„è§’è‰²åˆ—è¡¨
           
       async def batch_create_permissions(self, permissions_data: List[Dict]) -> List[Permission]:
           # æ‰¹é‡åˆ›å»ºï¼šæ•°æ®éªŒè¯ã€æ‰¹é‡æ’å…¥ã€äº‹åŠ¡å¤„ç†
   ```

3. **é›†æˆç°æœ‰ç»„ä»¶**ï¼š
   - ä½¿ç”¨PermissionDaoçš„15ä¸ªä¸“ç”¨æ–¹æ³•
   - ä½¿ç”¨RolePermissionDaoè¿›è¡Œå…³è”æŸ¥è¯¢
   - ä½¿ç”¨Permissionæ¨¡å‹çš„åˆ†ç±»æ–¹æ³•
   - é›†æˆç°æœ‰çš„æƒé™æ£€æŸ¥é€»è¾‘

4. **æƒé™ä»£ç è§„èŒƒ**ï¼š
   - æ ¼å¼ï¼šresource:actionï¼ˆå¦‚user:create, role:readï¼‰
   - èµ„æºç±»å‹ï¼šuser, role, permission, systemç­‰
   - æ“ä½œç±»å‹ï¼šcreate, read, update, delete, manageç­‰
   - ç‰¹æ®Šæƒé™ï¼šadmin:*, system:configç­‰

5. **æƒé™æ ‘ç»“æ„**ï¼š
   ```python
   # æƒé™æ ‘ç¤ºä¾‹ç»“æ„
   {
       "user": {
           "name": "ç”¨æˆ·ç®¡ç†",
           "permissions": [
               {"code": "user:create", "name": "åˆ›å»ºç”¨æˆ·"},
               {"code": "user:read", "name": "æŸ¥çœ‹ç”¨æˆ·"},
               {"code": "user:update", "name": "æ›´æ–°ç”¨æˆ·"},
               {"code": "user:delete", "name": "åˆ é™¤ç”¨æˆ·"}
           ]
       },
       "role": {
           "name": "è§’è‰²ç®¡ç†",
           "permissions": [...]
       }
   }
   ```

6. **æƒé™æ£€æŸ¥æœºåˆ¶**ï¼š
   - ç›´æ¥æƒé™æ£€æŸ¥ï¼ˆç”¨æˆ·->è§’è‰²->æƒé™ï¼‰
   - æƒé™ç»§æ‰¿æ£€æŸ¥ï¼ˆç®¡ç†å‘˜æƒé™ç»§æ‰¿ï¼‰
   - æƒé™ç¼“å­˜æœºåˆ¶ï¼ˆæé«˜æ£€æŸ¥æ€§èƒ½ï¼‰
   - æƒé™èŒƒå›´éªŒè¯ï¼ˆèµ„æºçº§æƒé™æ§åˆ¶ï¼‰

7. **æ‰¹é‡æ“ä½œæ”¯æŒ**ï¼š
   - æ‰¹é‡åˆ›å»ºæƒé™ï¼ˆç³»ç»Ÿåˆå§‹åŒ–ï¼‰
   - æ‰¹é‡æ›´æ–°æƒé™ï¼ˆæƒé™è°ƒæ•´ï¼‰
   - æ‰¹é‡åˆ é™¤æƒé™ï¼ˆæ¨¡å—ä¸‹çº¿ï¼‰
   - æ‰¹é‡æƒé™æ£€æŸ¥ï¼ˆæ¥å£æƒé™éªŒè¯ï¼‰

è¯·ç¡®ä¿æƒé™æ£€æŸ¥æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜æœºåˆ¶å®ç°ã€‚
```

---

## ğŸ” ç¬¬5è½®æ£€æŸ¥æç¤ºè¯

```
è¯·å…¨é¢æ£€æŸ¥æƒé™ä¸šåŠ¡æœåŠ¡çš„å®ç°è´¨é‡ï¼š

1. **æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•**ï¼š
   - æµ‹è¯•æƒé™åˆ›å»ºï¼šcreate_permissionæ–¹æ³•
   - æµ‹è¯•æƒé™æ›´æ–°ï¼šupdate_permissionæ–¹æ³•
   - æµ‹è¯•æƒé™åˆ é™¤ï¼šdelete_permissionæ–¹æ³•
   - æµ‹è¯•æƒé™æ ‘æ„å»ºï¼šget_permission_treeæ–¹æ³•
   - æµ‹è¯•æƒé™æ£€æŸ¥ï¼šcheck_permissionæ–¹æ³•
   - æµ‹è¯•èµ„æºæƒé™æŸ¥è¯¢ï¼šget_resource_permissionsæ–¹æ³•
   - æµ‹è¯•æ‰¹é‡åˆ›å»ºï¼šbatch_create_permissionsæ–¹æ³•

2. **æƒé™ä»£ç éªŒè¯**ï¼š
   - æµ‹è¯•æƒé™ä»£ç æ ¼å¼éªŒè¯ï¼ˆresource:actionæ ¼å¼ï¼‰
   - æµ‹è¯•èµ„æºç±»å‹æœ‰æ•ˆæ€§æ£€æŸ¥
   - æµ‹è¯•æ“ä½œç±»å‹æœ‰æ•ˆæ€§æ£€æŸ¥
   - æµ‹è¯•ç‰¹æ®Šæƒé™ä»£ç å¤„ç†

3. **æƒé™æ ‘ç»“æ„æµ‹è¯•**ï¼š
   - éªŒè¯æƒé™æ ‘çš„æ•°æ®ç»“æ„æ­£ç¡®æ€§
   - æµ‹è¯•æŒ‰èµ„æºç±»å‹åˆ†ç»„åŠŸèƒ½
   - æµ‹è¯•æƒé™å±‚çº§å…³ç³»
   - éªŒè¯æ ‘å½¢æ•°æ®çš„å®Œæ•´æ€§

4. **æƒé™æ£€æŸ¥æœºåˆ¶æµ‹è¯•**ï¼š
   - æµ‹è¯•ç›´æ¥æƒé™æ£€æŸ¥
   - æµ‹è¯•æƒé™ç»§æ‰¿æœºåˆ¶
   - æµ‹è¯•æƒé™ç¼“å­˜åŠŸèƒ½
   - æµ‹è¯•æƒé™èŒƒå›´éªŒè¯

5. **æ€§èƒ½æµ‹è¯•**ï¼š
   - æµ‹è¯•æƒé™æ£€æŸ¥æ€§èƒ½ï¼ˆå•æ¬¡å’Œæ‰¹é‡ï¼‰
   - æµ‹è¯•æƒé™æ ‘æ„å»ºæ€§èƒ½
   - æµ‹è¯•ç¼“å­˜æœºåˆ¶æ•ˆæœ
   - æµ‹è¯•æ‰¹é‡æ“ä½œæ€§èƒ½

6. **é›†æˆå’Œå®‰å…¨æµ‹è¯•**ï¼š
   - æµ‹è¯•ä¸PermissionDaoçš„é›†æˆ
   - æµ‹è¯•ä¸RolePermissionDaoçš„é›†æˆ
   - éªŒè¯æƒé™éªŒè¯çš„å®‰å…¨æ€§
   - æ£€æŸ¥æƒé™ç»•è¿‡é£é™©

7. **å¼‚å¸¸å¤„ç†æµ‹è¯•**ï¼š
   - æµ‹è¯•æƒé™ä¸å­˜åœ¨å¼‚å¸¸
   - æµ‹è¯•æƒé™ä»£ç æ ¼å¼å¼‚å¸¸
   - æµ‹è¯•ä¾èµ–å…³ç³»å†²çªå¼‚å¸¸
   - æµ‹è¯•æ‰¹é‡æ“ä½œå¼‚å¸¸å¤„ç†

å¦‚æœå‘ç°é—®é¢˜ï¼Œè¯·ä¿®å¤å¹¶é‡æ–°éªŒè¯æ‰€æœ‰åŠŸèƒ½ã€‚
```

---

## ğŸ¯ ç¬¬6è½®æç¤ºè¯ï¼šè®¤è¯ä¸šåŠ¡æœåŠ¡å¼€å‘

```
è¯·å¼€å‘è®¤è¯ä¸šåŠ¡æœåŠ¡ç±»ï¼Œå¤„ç†ç”¨æˆ·è®¤è¯ã€JWTä»¤ç‰Œç®¡ç†å’Œä¼šè¯æ§åˆ¶ã€‚å…·ä½“è¦æ±‚ï¼š

1. **æ–‡ä»¶ä½ç½®**ï¼šservices/auth_service.py

2. **ç±»è®¾è®¡**ï¼š
   ```python
   class AuthService(BaseService):
       def __init__(self, session):
           # åˆå§‹åŒ–UserServiceã€JWTé…ç½®ç­‰ç»„ä»¶
           
       # æ ¸å¿ƒè®¤è¯æ–¹æ³•
       async def login(self, username: str, password: str, remember_me: bool = False) -> Dict:
           # ç”¨æˆ·ç™»å½•ï¼šèº«ä»½éªŒè¯ã€ä»¤ç‰Œç”Ÿæˆã€ä¼šè¯åˆ›å»º
           
       async def logout(self, token: str) -> bool:
           # ç”¨æˆ·ç™»å‡ºï¼šä»¤ç‰Œå¤±æ•ˆã€ä¼šè¯æ¸…ç†ã€æ—¥å¿—è®°å½•
           
       async def refresh_token(self, refresh_token: str) -> Dict:
           # ä»¤ç‰Œåˆ·æ–°ï¼šåˆ·æ–°ä»¤ç‰ŒéªŒè¯ã€æ–°ä»¤ç‰Œç”Ÿæˆã€ä¼šè¯å»¶æœŸ
           
       async def verify_token(self, token: str) -> Optional[Dict]:
           # ä»¤ç‰ŒéªŒè¯ï¼šä»¤ç‰Œè§£æã€æœ‰æ•ˆæ€§æ£€æŸ¥ã€ç”¨æˆ·ä¿¡æ¯è·å–
           
       async def check_permission(self, user_id: int, permission_code: str) -> bool:
           # æƒé™æ£€æŸ¥ï¼šç”¨æˆ·æƒé™éªŒè¯ã€æƒé™ç¼“å­˜ã€ç»“æœè¿”å›
           
       async def generate_jwt(self, user: User, remember_me: bool = False) -> Dict:
           # JWTç”Ÿæˆï¼šç”¨æˆ·ä¿¡æ¯ç¼–ç ã€è¿‡æœŸæ—¶é—´è®¾ç½®ã€ä»¤ç‰Œç­¾å
           
       async def revoke_all_tokens(self, user_id: int) -> bool:
           # æ’¤é”€æ‰€æœ‰ä»¤ç‰Œï¼šç”¨æˆ·æ‰€æœ‰ä¼šè¯å¤±æ•ˆã€å®‰å…¨æ¸…ç†
   ```

3. **JWTä»¤ç‰Œç®¡ç†**ï¼š
   - è®¿é—®ä»¤ç‰Œï¼ˆAccess Tokenï¼‰ï¼šçŸ­æœŸæœ‰æ•ˆï¼ˆ15åˆ†é’Ÿï¼‰
   - åˆ·æ–°ä»¤ç‰Œï¼ˆRefresh Tokenï¼‰ï¼šé•¿æœŸæœ‰æ•ˆï¼ˆ7å¤©ï¼‰
   - è®°ä½æˆ‘åŠŸèƒ½ï¼šå»¶é•¿åˆ·æ–°ä»¤ç‰Œæœ‰æ•ˆæœŸï¼ˆ30å¤©ï¼‰
   - ä»¤ç‰Œé»‘åå•ï¼šæ”¯æŒä»¤ç‰Œä¸»åŠ¨å¤±æ•ˆ

4. **ä»¤ç‰Œç»“æ„è®¾è®¡**ï¼š
   ```python
   # Access Token Payload
   {
       "sub": "user_id",           # ç”¨æˆ·ID
       "username": "username",     # ç”¨æˆ·å
       "email": "email",          # é‚®ç®±
       "roles": ["role1", "role2"], # è§’è‰²åˆ—è¡¨
       "permissions": ["perm1"],   # æƒé™åˆ—è¡¨
       "exp": 1234567890,         # è¿‡æœŸæ—¶é—´
       "iat": 1234567890,         # ç­¾å‘æ—¶é—´
       "jti": "token_id"          # ä»¤ç‰ŒID
   }
   ```

5. **å®‰å…¨æœºåˆ¶**ï¼š
   - å¯†ç é”™è¯¯æ¬¡æ•°é™åˆ¶ï¼ˆ5æ¬¡é”å®šï¼‰
   - IPåœ°å€éªŒè¯å’Œè®°å½•
   - è®¾å¤‡æŒ‡çº¹è¯†åˆ«
   - å¼‚å¸¸ç™»å½•æ£€æµ‹å’Œé€šçŸ¥
   - ä¼šè¯å¹¶å‘æ§åˆ¶

6. **ä¼šè¯ç®¡ç†**ï¼š
   - ä¼šè¯åˆ›å»ºå’Œå­˜å‚¨
   - ä¼šè¯çŠ¶æ€è·Ÿè¸ª
   - ä¼šè¯è¶…æ—¶å¤„ç†
   - å¤šè®¾å¤‡ä¼šè¯ç®¡ç†
   - ä¼šè¯å®‰å…¨æ¸…ç†

7. **é›†æˆç°æœ‰ç»„ä»¶**ï¼š
   - ä½¿ç”¨UserServiceè¿›è¡Œç”¨æˆ·éªŒè¯
   - ä½¿ç”¨PermissionServiceè¿›è¡Œæƒé™æ£€æŸ¥
   - é›†æˆconfig/jwt_config.pyé…ç½®
   - ä½¿ç”¨ç°æœ‰çš„å¯†ç éªŒè¯å·¥å…·

8. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - æƒé™ä¿¡æ¯ç¼“å­˜
   - ä»¤ç‰ŒéªŒè¯ç¼“å­˜
   - ä¼šè¯ä¿¡æ¯ç¼“å­˜
   - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

è¯·ç¡®ä¿æ‰€æœ‰å®‰å…¨æœºåˆ¶éƒ½æ­£ç¡®å®ç°ï¼Œç‰¹åˆ«æ˜¯ä»¤ç‰Œå®‰å…¨å’Œä¼šè¯ç®¡ç†ã€‚
```

---

## ğŸ” ç¬¬6è½®æ£€æŸ¥æç¤ºè¯

```
è¯·å…¨é¢æ£€æŸ¥è®¤è¯ä¸šåŠ¡æœåŠ¡çš„å®‰å…¨æ€§å’ŒåŠŸèƒ½å®Œæ•´æ€§ï¼š

1. **æ ¸å¿ƒè®¤è¯åŠŸèƒ½æµ‹è¯•**ï¼š
   - æµ‹è¯•ç”¨æˆ·ç™»å½•ï¼šloginæ–¹æ³•ï¼ˆæ­£å¸¸å’Œå¼‚å¸¸æƒ…å†µï¼‰
   - æµ‹è¯•ç”¨æˆ·ç™»å‡ºï¼šlogoutæ–¹æ³•
   - æµ‹è¯•ä»¤ç‰Œåˆ·æ–°ï¼šrefresh_tokenæ–¹æ³•
   - æµ‹è¯•ä»¤ç‰ŒéªŒè¯ï¼šverify_tokenæ–¹æ³•
   - æµ‹è¯•æƒé™æ£€æŸ¥ï¼šcheck_permissionæ–¹æ³•
   - æµ‹è¯•JWTç”Ÿæˆï¼šgenerate_jwtæ–¹æ³•

2. **JWTä»¤ç‰Œå®‰å…¨æµ‹è¯•**ï¼š
   - éªŒè¯ä»¤ç‰Œç­¾åç®—æ³•å®‰å…¨æ€§
   - æµ‹è¯•ä»¤ç‰Œè¿‡æœŸæ—¶é—´è®¾ç½®
   - æµ‹è¯•ä»¤ç‰Œç»“æ„å’Œè½½è·æ­£ç¡®æ€§
   - éªŒè¯ä»¤ç‰Œé»‘åå•æœºåˆ¶
   - æµ‹è¯•ä»¤ç‰Œç¯¡æ”¹æ£€æµ‹

3. **å®‰å…¨æœºåˆ¶æµ‹è¯•**ï¼š
   - æµ‹è¯•å¯†ç é”™è¯¯æ¬¡æ•°é™åˆ¶
   - æµ‹è¯•IPåœ°å€éªŒè¯
   - æµ‹è¯•å¼‚å¸¸ç™»å½•æ£€æµ‹
   - æµ‹è¯•ä¼šè¯å¹¶å‘æ§åˆ¶
   - éªŒè¯è®¾å¤‡æŒ‡çº¹è¯†åˆ«

4. **ä¼šè¯ç®¡ç†æµ‹è¯•**ï¼š
   - æµ‹è¯•ä¼šè¯åˆ›å»ºå’Œå­˜å‚¨
   - æµ‹è¯•ä¼šè¯çŠ¶æ€è·Ÿè¸ª
   - æµ‹è¯•ä¼šè¯è¶…æ—¶å¤„ç†
   - æµ‹è¯•å¤šè®¾å¤‡ä¼šè¯ç®¡ç†
   - æµ‹è¯•ä¼šè¯å®‰å…¨æ¸…ç†

5. **æ€§èƒ½æµ‹è¯•**ï¼š
   - æµ‹è¯•ä»¤ç‰ŒéªŒè¯æ€§èƒ½
   - æµ‹è¯•æƒé™æ£€æŸ¥æ€§èƒ½
   - æµ‹è¯•ç¼“å­˜æœºåˆ¶æ•ˆæœ
   - æµ‹è¯•å¹¶å‘è®¤è¯æ€§èƒ½

6. **é›†æˆæµ‹è¯•**ï¼š
   - æµ‹è¯•ä¸UserServiceçš„é›†æˆ
   - æµ‹è¯•ä¸PermissionServiceçš„é›†æˆ
   - æµ‹è¯•ä¸JWTé…ç½®çš„é›†æˆ
   - éªŒè¯ä¸ç°æœ‰å·¥å…·çš„é›†æˆ

7. **å®‰å…¨æ¼æ´æ£€æŸ¥**ï¼š
   - æ£€æŸ¥JWTä»¤ç‰Œæ³„éœ²é£é™©
   - éªŒè¯ä¼šè¯åŠ«æŒé˜²æŠ¤
   - æ£€æŸ¥æƒé™ç»•è¿‡é£é™©
   - æµ‹è¯•æš´åŠ›ç ´è§£é˜²æŠ¤

8. **å¼‚å¸¸å¤„ç†æµ‹è¯•**ï¼š
   - æµ‹è¯•æ— æ•ˆä»¤ç‰Œå¤„ç†
   - æµ‹è¯•è¿‡æœŸä»¤ç‰Œå¤„ç†
   - æµ‹è¯•ç”¨æˆ·ä¸å­˜åœ¨å¼‚å¸¸
   - æµ‹è¯•æƒé™ä¸è¶³å¼‚å¸¸

å¦‚æœå‘ç°ä»»ä½•å®‰å…¨é—®é¢˜æˆ–åŠŸèƒ½ç¼ºé™·ï¼Œè¯·ç«‹å³ä¿®å¤å¹¶é‡æ–°æµ‹è¯•ã€‚
```

---

## ğŸ¯ ç¬¬7è½®æç¤ºè¯ï¼šFastAPIåº”ç”¨åŸºç¡€å¼€å‘

```
è¯·å¼€å‘FastAPIåº”ç”¨çš„åŸºç¡€æ¶æ„ï¼ŒåŒ…æ‹¬åº”ç”¨é…ç½®ã€ä¸­é—´ä»¶å’Œè·¯ç”±æ³¨å†Œã€‚å…·ä½“è¦æ±‚ï¼š

1. **æ–‡ä»¶ä½ç½®**ï¼šapi/app.py

2. **FastAPIåº”ç”¨é…ç½®**ï¼š
   ```python
   app = FastAPI(
       title="RBACæƒé™ç³»ç»ŸAPI",
       description="åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ç³»ç»ŸWebAPI",
       version="1.0.0",
       docs_url="/docs",
       redoc_url="/redoc",
       openapi_url="/openapi.json"
   )
   ```

3. **ä¸­é—´ä»¶é…ç½®**ï¼š
   - CORSä¸­é—´ä»¶ï¼šæ”¯æŒè·¨åŸŸè¯·æ±‚
   - è®¤è¯ä¸­é—´ä»¶ï¼šJWTä»¤ç‰ŒéªŒè¯
   - å¼‚å¸¸å¤„ç†ä¸­é—´ä»¶ï¼šç»Ÿä¸€å¼‚å¸¸å“åº”æ ¼å¼
   - è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶ï¼šè®°å½•APIè®¿é—®æ—¥å¿—
   - æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶ï¼šè®°å½•å“åº”æ—¶é—´

4. **ä¾èµ–æ³¨å…¥é…ç½®**ï¼š
   ```python
   # æ•°æ®åº“ä¼šè¯ä¾èµ–
   async def get_db_session():
       # åˆ›å»ºæ•°æ®åº“ä¼šè¯ï¼Œè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ

   # æœåŠ¡å±‚ä¾èµ–
   async def get_user_service(session = Depends(get_db_session)):
       # åˆ›å»ºUserServiceå®ä¾‹

   async def get_auth_service(session = Depends(get_db_session)):
       # åˆ›å»ºAuthServiceå®ä¾‹
   ```

5. **è·¯ç”±æ³¨å†Œå‡†å¤‡**ï¼š
   - åˆ›å»ºè·¯ç”±ç»„ï¼š/api/v1å‰ç¼€
   - ç”¨æˆ·ç®¡ç†è·¯ç”±ï¼š/api/v1/users
   - è§’è‰²ç®¡ç†è·¯ç”±ï¼š/api/v1/roles
   - æƒé™ç®¡ç†è·¯ç”±ï¼š/api/v1/permissions
   - è®¤è¯ç›¸å…³è·¯ç”±ï¼š/api/v1/auth

6. **å…¨å±€å¼‚å¸¸å¤„ç†**ï¼š
   ```python
   @app.exception_handler(BusinessLogicError)
   async def business_logic_exception_handler(request, exc):
       # ä¸šåŠ¡é€»è¾‘å¼‚å¸¸å¤„ç†

   @app.exception_handler(AuthenticationError)
   async def authentication_exception_handler(request, exc):
       # è®¤è¯å¼‚å¸¸å¤„ç†

   @app.exception_handler(ValidationError)
   async def validation_exception_handler(request, exc):
       # æ•°æ®éªŒè¯å¼‚å¸¸å¤„ç†
   ```

7. **å¯åŠ¨å’Œå…³é—­äº‹ä»¶**ï¼š
   - åº”ç”¨å¯åŠ¨æ—¶çš„åˆå§‹åŒ–æ“ä½œ
   - æ•°æ®åº“è¿æ¥æ± åˆå§‹åŒ–
   - ç¼“å­˜ç³»ç»Ÿåˆå§‹åŒ–
   - åº”ç”¨å…³é—­æ—¶çš„æ¸…ç†æ“ä½œ

8. **å¥åº·æ£€æŸ¥æ¥å£**ï¼š
   - GET /healthï¼šåº”ç”¨å¥åº·çŠ¶æ€
   - GET /health/dbï¼šæ•°æ®åº“è¿æ¥çŠ¶æ€
   - GET /health/cacheï¼šç¼“å­˜ç³»ç»ŸçŠ¶æ€

è¯·ç¡®ä¿æ‰€æœ‰é…ç½®éƒ½æ”¯æŒå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„åŒºåˆ†ã€‚
```

---

## ğŸ” ç¬¬7è½®æ£€æŸ¥æç¤ºè¯

```
è¯·æ£€æŸ¥FastAPIåº”ç”¨åŸºç¡€æ¶æ„çš„å®ç°è´¨é‡ï¼š

1. **åº”ç”¨é…ç½®æ£€æŸ¥**ï¼š
   - éªŒè¯FastAPIåº”ç”¨æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
   - æ£€æŸ¥APIæ–‡æ¡£é…ç½®æ˜¯å¦æ­£ç¡®
   - æµ‹è¯•Swagger UIæ˜¯å¦å¯è®¿é—®ï¼ˆ/docsï¼‰
   - æµ‹è¯•ReDocæ–‡æ¡£æ˜¯å¦å¯è®¿é—®ï¼ˆ/redocï¼‰

2. **ä¸­é—´ä»¶åŠŸèƒ½æµ‹è¯•**ï¼š
   - æµ‹è¯•CORSä¸­é—´ä»¶ï¼šè·¨åŸŸè¯·æ±‚å¤„ç†
   - æµ‹è¯•å¼‚å¸¸å¤„ç†ä¸­é—´ä»¶ï¼šå¼‚å¸¸å“åº”æ ¼å¼
   - æµ‹è¯•è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶ï¼šæ—¥å¿—è®°å½•åŠŸèƒ½
   - æµ‹è¯•æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶ï¼šå“åº”æ—¶é—´è®°å½•

3. **ä¾èµ–æ³¨å…¥æµ‹è¯•**ï¼š
   - æµ‹è¯•æ•°æ®åº“ä¼šè¯ä¾èµ–ï¼šget_db_session
   - æµ‹è¯•æœåŠ¡å±‚ä¾èµ–ï¼šget_user_serviceç­‰
   - éªŒè¯ä¾èµ–æ³¨å…¥çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
   - æµ‹è¯•ä¾èµ–æ³¨å…¥çš„å¼‚å¸¸å¤„ç†

4. **å¼‚å¸¸å¤„ç†æµ‹è¯•**ï¼š
   - æµ‹è¯•ä¸šåŠ¡é€»è¾‘å¼‚å¸¸å¤„ç†
   - æµ‹è¯•è®¤è¯å¼‚å¸¸å¤„ç†
   - æµ‹è¯•æ•°æ®éªŒè¯å¼‚å¸¸å¤„ç†
   - éªŒè¯å¼‚å¸¸å“åº”æ ¼å¼ç»Ÿä¸€æ€§

5. **å¯åŠ¨å’Œå…³é—­æµ‹è¯•**ï¼š
   - æµ‹è¯•åº”ç”¨å¯åŠ¨äº‹ä»¶å¤„ç†
   - æµ‹è¯•æ•°æ®åº“è¿æ¥æ± åˆå§‹åŒ–
   - æµ‹è¯•åº”ç”¨å…³é—­äº‹ä»¶å¤„ç†
   - éªŒè¯èµ„æºæ¸…ç†æ˜¯å¦æ­£ç¡®

6. **å¥åº·æ£€æŸ¥æµ‹è¯•**ï¼š
   - æµ‹è¯•åº”ç”¨å¥åº·æ£€æŸ¥ï¼šGET /health
   - æµ‹è¯•æ•°æ®åº“å¥åº·æ£€æŸ¥ï¼šGET /health/db
   - éªŒè¯å¥åº·æ£€æŸ¥å“åº”æ ¼å¼
   - æµ‹è¯•å¥åº·æ£€æŸ¥çš„æ€§èƒ½

7. **ç¯å¢ƒé…ç½®æµ‹è¯•**ï¼š
   - æµ‹è¯•å¼€å‘ç¯å¢ƒé…ç½®
   - æµ‹è¯•ç”Ÿäº§ç¯å¢ƒé…ç½®
   - éªŒè¯ç¯å¢ƒå˜é‡è¯»å–
   - æ£€æŸ¥é…ç½®å®‰å…¨æ€§

å¦‚æœå‘ç°é…ç½®é—®é¢˜æˆ–åŠŸèƒ½ç¼ºé™·ï¼Œè¯·ä¿®å¤å¹¶é‡æ–°æµ‹è¯•ã€‚
```

---

## ğŸ¯ ç¬¬8è½®æç¤ºè¯ï¼šæ•°æ®æ¨¡å¼å®šä¹‰å¼€å‘

```
è¯·å¼€å‘APIæ¥å£çš„æ•°æ®æ¨¡å¼å®šä¹‰ï¼Œä½¿ç”¨Pydanticè¿›è¡Œæ•°æ®éªŒè¯å’Œåºåˆ—åŒ–ã€‚å…·ä½“è¦æ±‚ï¼š

1. **æ–‡ä»¶ä½ç½®**ï¼šapi/schemas/ç›®å½•ä¸‹çš„å¤šä¸ªæ–‡ä»¶

2. **ç”¨æˆ·ç›¸å…³æ¨¡å¼**ï¼ˆapi/schemas/user_schemas.pyï¼‰ï¼š
   ```python
   # è¯·æ±‚æ¨¡å¼
   class UserCreateRequest(BaseModel):
       username: str = Field(..., min_length=3, max_length=50, regex="^[a-zA-Z0-9_]+$")
       email: EmailStr
       password: str = Field(..., min_length=8, max_length=128)
       full_name: Optional[str] = Field(None, max_length=100)

   class UserUpdateRequest(BaseModel):
       full_name: Optional[str] = Field(None, max_length=100)
       email: Optional[EmailStr] = None
       status: Optional[int] = Field(None, ge=0, le=2)

   class PasswordChangeRequest(BaseModel):
       old_password: str
       new_password: str = Field(..., min_length=8, max_length=128)

   # å“åº”æ¨¡å¼
   class UserResponse(BaseModel):
       id: int
       username: str
       email: str
       full_name: Optional[str]
       status: int
       created_at: datetime
       updated_at: datetime

       class Config:
           from_attributes = True

   class UserListResponse(BaseModel):
       users: List[UserResponse]
       total: int
       page: int
       size: int
       pages: int
   ```

3. **è§’è‰²ç›¸å…³æ¨¡å¼**ï¼ˆapi/schemas/role_schemas.pyï¼‰ï¼š
   ```python
   class RoleCreateRequest(BaseModel):
       name: str = Field(..., min_length=2, max_length=100)
       code: str = Field(..., regex="^ROLE_[A-Z_]+$")
       description: Optional[str] = Field(None, max_length=500)

   class RoleUpdateRequest(BaseModel):
       name: Optional[str] = Field(None, min_length=2, max_length=100)
       description: Optional[str] = Field(None, max_length=500)
       status: Optional[int] = Field(None, ge=0, le=1)

   class RoleResponse(BaseModel):
       id: int
       name: str
       code: str
       description: Optional[str]
       status: int
       created_at: datetime

       class Config:
           from_attributes = True

   class RolePermissionAssignRequest(BaseModel):
       permission_ids: List[int] = Field(..., min_items=1)
   ```

4. **æƒé™ç›¸å…³æ¨¡å¼**ï¼ˆapi/schemas/permission_schemas.pyï¼‰ï¼š
   ```python
   class PermissionCreateRequest(BaseModel):
       name: str = Field(..., min_length=2, max_length=100)
       code: str = Field(..., regex="^[a-z_]+:[a-z_]+$")
       resource_type: str = Field(..., min_length=2, max_length=50)
       action_type: str = Field(..., min_length=2, max_length=50)
       description: Optional[str] = Field(None, max_length=500)

   class PermissionResponse(BaseModel):
       id: int
       name: str
       code: str
       resource_type: str
       action_type: str
       description: Optional[str]
       created_at: datetime

       class Config:
           from_attributes = True

   class PermissionTreeResponse(BaseModel):
       resource_type: str
       resource_name: str
       permissions: List[PermissionResponse]
   ```

5. **è®¤è¯ç›¸å…³æ¨¡å¼**ï¼ˆapi/schemas/auth_schemas.pyï¼‰ï¼š
   ```python
   class LoginRequest(BaseModel):
       username: str = Field(..., min_length=3, max_length=50)
       password: str = Field(..., min_length=1)
       remember_me: bool = False

   class LoginResponse(BaseModel):
       access_token: str
       refresh_token: str
       token_type: str = "bearer"
       expires_in: int
       user: UserResponse

   class TokenRefreshRequest(BaseModel):
       refresh_token: str

   class TokenResponse(BaseModel):
       access_token: str
       refresh_token: str
       token_type: str = "bearer"
       expires_in: int
   ```

6. **é€šç”¨å“åº”æ¨¡å¼**ï¼ˆapi/schemas/common_schemas.pyï¼‰ï¼š
   ```python
   class SuccessResponse(BaseModel):
       success: bool = True
       message: str
       data: Optional[Any] = None

   class ErrorResponse(BaseModel):
       success: bool = False
       error_code: str
       error_message: str
       details: Optional[Dict] = None

   class PaginationParams(BaseModel):
       page: int = Field(1, ge=1)
       size: int = Field(20, ge=1, le=100)

   class PaginationResponse(BaseModel):
       total: int
       page: int
       size: int
       pages: int
   ```

7. **æ•°æ®éªŒè¯è§„åˆ™**ï¼š
   - å­—ç¬¦ä¸²é•¿åº¦é™åˆ¶
   - æ­£åˆ™è¡¨è¾¾å¼éªŒè¯
   - æ•°å€¼èŒƒå›´éªŒè¯
   - é‚®ç®±æ ¼å¼éªŒè¯
   - å¿…å¡«å­—æ®µéªŒè¯
   - è‡ªå®šä¹‰éªŒè¯å™¨

8. **åºåˆ—åŒ–é…ç½®**ï¼š
   - ä»ORMæ¨¡å‹è‡ªåŠ¨è½¬æ¢
   - æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–
   - æ•æ„Ÿä¿¡æ¯è¿‡æ»¤
   - åµŒå¥—å¯¹è±¡å¤„ç†

è¯·ç¡®ä¿æ‰€æœ‰æ¨¡å¼éƒ½æœ‰å®Œæ•´çš„éªŒè¯è§„åˆ™å’Œæ¸…æ™°çš„æ–‡æ¡£å­—ç¬¦ä¸²ã€‚
```

---

## ğŸ” ç¬¬8è½®æ£€æŸ¥æç¤ºè¯

```
è¯·å…¨é¢æ£€æŸ¥æ•°æ®æ¨¡å¼å®šä¹‰çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼š

1. **æ¨¡å¼ç»“æ„æ£€æŸ¥**ï¼š
   - éªŒè¯ç”¨æˆ·ç›¸å…³æ¨¡å¼ï¼šUserCreateRequestã€UserUpdateRequestã€UserResponseç­‰
   - éªŒè¯è§’è‰²ç›¸å…³æ¨¡å¼ï¼šRoleCreateRequestã€RoleResponseç­‰
   - éªŒè¯æƒé™ç›¸å…³æ¨¡å¼ï¼šPermissionCreateRequestã€PermissionResponseç­‰
   - éªŒè¯è®¤è¯ç›¸å…³æ¨¡å¼ï¼šLoginRequestã€LoginResponseç­‰
   - éªŒè¯é€šç”¨å“åº”æ¨¡å¼ï¼šSuccessResponseã€ErrorResponseç­‰

2. **æ•°æ®éªŒè¯æµ‹è¯•**ï¼š
   - æµ‹è¯•å­—ç¬¦ä¸²é•¿åº¦éªŒè¯ï¼ˆæœ€å°ã€æœ€å¤§é•¿åº¦ï¼‰
   - æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼éªŒè¯ï¼ˆç”¨æˆ·åã€è§’è‰²ä»£ç ã€æƒé™ä»£ç ï¼‰
   - æµ‹è¯•é‚®ç®±æ ¼å¼éªŒè¯
   - æµ‹è¯•æ•°å€¼èŒƒå›´éªŒè¯
   - æµ‹è¯•å¿…å¡«å­—æ®µéªŒè¯

3. **åºåˆ—åŒ–æµ‹è¯•**ï¼š
   - æµ‹è¯•ä»ORMæ¨¡å‹åˆ°å“åº”æ¨¡å¼çš„è½¬æ¢
   - æµ‹è¯•æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–
   - æµ‹è¯•åµŒå¥—å¯¹è±¡åºåˆ—åŒ–
   - æµ‹è¯•æ•æ„Ÿä¿¡æ¯è¿‡æ»¤ï¼ˆå¯†ç ç­‰ï¼‰

4. **ååºåˆ—åŒ–æµ‹è¯•**ï¼š
   - æµ‹è¯•è¯·æ±‚æ•°æ®åˆ°æ¨¡å¼å¯¹è±¡çš„è½¬æ¢
   - æµ‹è¯•æ•°æ®ç±»å‹è½¬æ¢
   - æµ‹è¯•é»˜è®¤å€¼å¤„ç†
   - æµ‹è¯•å¯é€‰å­—æ®µå¤„ç†

5. **è¾¹ç•Œæ¡ä»¶æµ‹è¯•**ï¼š
   - æµ‹è¯•ç©ºå€¼å¤„ç†
   - æµ‹è¯•è¶…é•¿å­—ç¬¦ä¸²å¤„ç†
   - æµ‹è¯•æ— æ•ˆæ ¼å¼æ•°æ®å¤„ç†
   - æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å¤„ç†

6. **æ€§èƒ½æµ‹è¯•**ï¼š
   - æµ‹è¯•å¤§é‡æ•°æ®çš„åºåˆ—åŒ–æ€§èƒ½
   - æµ‹è¯•å¤æ‚åµŒå¥—å¯¹è±¡çš„å¤„ç†æ€§èƒ½
   - æµ‹è¯•éªŒè¯è§„åˆ™çš„æ‰§è¡Œæ€§èƒ½

7. **æ–‡æ¡£å’Œé…ç½®æ£€æŸ¥**ï¼š
   - æ£€æŸ¥æ‰€æœ‰æ¨¡å¼æ˜¯å¦æœ‰æ–‡æ¡£å­—ç¬¦ä¸²
   - éªŒè¯Configç±»é…ç½®æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥å­—æ®µæè¿°æ˜¯å¦æ¸…æ™°
   - éªŒè¯ç¤ºä¾‹æ•°æ®æ˜¯å¦æ­£ç¡®

8. **é›†æˆæµ‹è¯•**ï¼š
   - æµ‹è¯•ä¸FastAPIçš„é›†æˆ
   - æµ‹è¯•ä¸ORMæ¨¡å‹çš„å…¼å®¹æ€§
   - éªŒè¯APIæ–‡æ¡£ç”Ÿæˆæ˜¯å¦æ­£ç¡®
   - æµ‹è¯•é”™è¯¯ä¿¡æ¯çš„å‹å¥½æ€§

å¦‚æœå‘ç°éªŒè¯è§„åˆ™ä¸å½“æˆ–åºåˆ—åŒ–é—®é¢˜ï¼Œè¯·ä¿®å¤å¹¶é‡æ–°æµ‹è¯•ã€‚
```

---

## ğŸ¯ ç¬¬9è½®æç¤ºè¯ï¼šè®¤è¯ä¸­é—´ä»¶å¼€å‘

```
è¯·å¼€å‘JWTè®¤è¯ä¸­é—´ä»¶å’Œæƒé™æ£€æŸ¥è£…é¥°å™¨ï¼Œå®ç°APIæ¥å£çš„å®‰å…¨è®¿é—®æ§åˆ¶ã€‚å…·ä½“è¦æ±‚ï¼š

1. **æ–‡ä»¶ä½ç½®**ï¼šapi/middleware/auth_middleware.py

2. **JWTè®¤è¯ä¸­é—´ä»¶**ï¼š
   ```python
   from fastapi import Depends, HTTPException, status
   from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials

   security = HTTPBearer()

   async def get_current_user(
       credentials: HTTPAuthorizationCredentials = Depends(security),
       auth_service: AuthService = Depends(get_auth_service)
   ) -> User:
       # JWTä»¤ç‰ŒéªŒè¯å’Œç”¨æˆ·ä¿¡æ¯è·å–

   async def get_current_active_user(
       current_user: User = Depends(get_current_user)
   ) -> User:
       # ç”¨æˆ·çŠ¶æ€æ£€æŸ¥ï¼ˆæ˜¯å¦å¯ç”¨ã€æ˜¯å¦é”å®šï¼‰

   async def verify_jwt_token(token: str, auth_service: AuthService) -> Dict:
       # JWTä»¤ç‰Œè§£æå’ŒéªŒè¯
   ```

3. **æƒé™æ£€æŸ¥è£…é¥°å™¨**ï¼š
   ```python
   def require_permissions(permissions: List[str]):
       def decorator(func):
           async def wrapper(*args, **kwargs):
               # è·å–å½“å‰ç”¨æˆ·
               # æ£€æŸ¥ç”¨æˆ·æƒé™
               # æƒé™éªŒè¯é€šè¿‡åæ‰§è¡ŒåŸå‡½æ•°

   def require_roles(roles: List[str]):
       def decorator(func):
           async def wrapper(*args, **kwargs):
               # è·å–å½“å‰ç”¨æˆ·
               # æ£€æŸ¥ç”¨æˆ·è§’è‰²
               # è§’è‰²éªŒè¯é€šè¿‡åæ‰§è¡ŒåŸå‡½æ•°

   def require_admin():
       # ç®¡ç†å‘˜æƒé™æ£€æŸ¥è£…é¥°å™¨

   def optional_auth():
       # å¯é€‰è®¤è¯è£…é¥°å™¨ï¼ˆå…è®¸åŒ¿åè®¿é—®ï¼‰
   ```

4. **æƒé™æ£€æŸ¥ä¾èµ–**ï¼š
   ```python
   class PermissionChecker:
       def __init__(self, required_permissions: List[str]):
           self.required_permissions = required_permissions

       async def __call__(
           self,
           current_user: User = Depends(get_current_active_user),
           auth_service: AuthService = Depends(get_auth_service)
       ):
           # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·æœ‰æ‰€éœ€æƒé™

   def RequirePermissions(permissions: List[str]):
       return Depends(PermissionChecker(permissions))
   ```

5. **å¼‚å¸¸å¤„ç†**ï¼š
   ```python
   class AuthenticationException(HTTPException):
       def __init__(self, detail: str = "Authentication failed"):
           super().__init__(
               status_code=status.HTTP_401_UNAUTHORIZED,
               detail=detail,
               headers={"WWW-Authenticate": "Bearer"}
           )

   class AuthorizationException(HTTPException):
       def __init__(self, detail: str = "Insufficient permissions"):
           super().__init__(
               status_code=status.HTTP_403_FORBIDDEN,
               detail=detail
           )
   ```

6. **ä»¤ç‰Œå¤„ç†åŠŸèƒ½**ï¼š
   - ä»è¯·æ±‚å¤´æå–Bearerä»¤ç‰Œ
   - JWTä»¤ç‰Œè§£æå’ŒéªŒè¯
   - ä»¤ç‰Œè¿‡æœŸæ£€æŸ¥
   - ä»¤ç‰Œé»‘åå•æ£€æŸ¥
   - ç”¨æˆ·ä¿¡æ¯ç¼“å­˜

7. **æƒé™éªŒè¯é€»è¾‘**ï¼š
   - ç”¨æˆ·æƒé™è·å–å’Œç¼“å­˜
   - æƒé™ç»§æ‰¿å…³ç³»å¤„ç†
   - èµ„æºçº§æƒé™æ£€æŸ¥
   - æƒé™èŒƒå›´éªŒè¯

8. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - ç”¨æˆ·ä¿¡æ¯ç¼“å­˜æœºåˆ¶
   - æƒé™ä¿¡æ¯ç¼“å­˜æœºåˆ¶
   - ä»¤ç‰ŒéªŒè¯ç¼“å­˜
   - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

9. **å®‰å…¨æœºåˆ¶**ï¼š
   - ä»¤ç‰Œæ³„éœ²æ£€æµ‹
   - å¼‚å¸¸è®¿é—®è®°å½•
   - IPåœ°å€éªŒè¯
   - è¯·æ±‚é¢‘ç‡é™åˆ¶

è¯·ç¡®ä¿ä¸­é—´ä»¶çš„æ€§èƒ½å’Œå®‰å…¨æ€§éƒ½è¾¾åˆ°ç”Ÿäº§ç¯å¢ƒè¦æ±‚ã€‚
```

---

## ğŸ” ç¬¬9è½®æ£€æŸ¥æç¤ºè¯

```
è¯·å…¨é¢æ£€æŸ¥è®¤è¯ä¸­é—´ä»¶çš„å®‰å…¨æ€§å’ŒåŠŸèƒ½å®Œæ•´æ€§ï¼š

1. **JWTè®¤è¯åŠŸèƒ½æµ‹è¯•**ï¼š
   - æµ‹è¯•æœ‰æ•ˆä»¤ç‰Œçš„éªŒè¯ï¼šget_current_user
   - æµ‹è¯•æ— æ•ˆä»¤ç‰Œçš„å¤„ç†
   - æµ‹è¯•è¿‡æœŸä»¤ç‰Œçš„å¤„ç†
   - æµ‹è¯•ç”¨æˆ·çŠ¶æ€æ£€æŸ¥ï¼šget_current_active_user
   - æµ‹è¯•ä»¤ç‰Œè§£æåŠŸèƒ½ï¼šverify_jwt_token

2. **æƒé™æ£€æŸ¥æµ‹è¯•**ï¼š
   - æµ‹è¯•æƒé™è£…é¥°å™¨ï¼šrequire_permissions
   - æµ‹è¯•è§’è‰²è£…é¥°å™¨ï¼šrequire_roles
   - æµ‹è¯•ç®¡ç†å‘˜è£…é¥°å™¨ï¼šrequire_admin
   - æµ‹è¯•å¯é€‰è®¤è¯ï¼šoptional_auth
   - æµ‹è¯•æƒé™æ£€æŸ¥ä¾èµ–ï¼šRequirePermissions

3. **å¼‚å¸¸å¤„ç†æµ‹è¯•**ï¼š
   - æµ‹è¯•è®¤è¯å¼‚å¸¸ï¼šAuthenticationException
   - æµ‹è¯•æˆæƒå¼‚å¸¸ï¼šAuthorizationException
   - æµ‹è¯•å¼‚å¸¸å“åº”æ ¼å¼
   - æµ‹è¯•å¼‚å¸¸çŠ¶æ€ç æ­£ç¡®æ€§

4. **å®‰å…¨æ€§æµ‹è¯•**ï¼š
   - æµ‹è¯•ä»¤ç‰Œç¯¡æ”¹æ£€æµ‹
   - æµ‹è¯•ä»¤ç‰Œé‡æ”¾æ”»å‡»é˜²æŠ¤
   - æµ‹è¯•æƒé™ç»•è¿‡å°è¯•
   - æµ‹è¯•å¼‚å¸¸è®¿é—®è®°å½•

5. **æ€§èƒ½æµ‹è¯•**ï¼š
   - æµ‹è¯•ä»¤ç‰ŒéªŒè¯æ€§èƒ½
   - æµ‹è¯•æƒé™æ£€æŸ¥æ€§èƒ½
   - æµ‹è¯•ç¼“å­˜æœºåˆ¶æ•ˆæœ
   - æµ‹è¯•å¹¶å‘è®¿é—®æ€§èƒ½

6. **é›†æˆæµ‹è¯•**ï¼š
   - æµ‹è¯•ä¸AuthServiceçš„é›†æˆ
   - æµ‹è¯•ä¸FastAPIçš„é›†æˆ
   - æµ‹è¯•ä¸æ•°æ®åº“çš„é›†æˆ
   - æµ‹è¯•ä¸ç¼“å­˜ç³»ç»Ÿçš„é›†æˆ

7. **è¾¹ç•Œæ¡ä»¶æµ‹è¯•**ï¼š
   - æµ‹è¯•ç©ºä»¤ç‰Œå¤„ç†
   - æµ‹è¯•æ ¼å¼é”™è¯¯ä»¤ç‰Œå¤„ç†
   - æµ‹è¯•ç”¨æˆ·ä¸å­˜åœ¨æƒ…å†µ
   - æµ‹è¯•æƒé™ä¸ºç©ºæƒ…å†µ

8. **å®é™…åœºæ™¯æµ‹è¯•**ï¼š
   - æµ‹è¯•ç”¨æˆ·ç™»å½•åçš„APIè®¿é—®
   - æµ‹è¯•æƒé™ä¸è¶³çš„APIè®¿é—®
   - æµ‹è¯•ä»¤ç‰Œè¿‡æœŸåçš„å¤„ç†
   - æµ‹è¯•å¤šè®¾å¤‡åŒæ—¶è®¿é—®

å¦‚æœå‘ç°å®‰å…¨æ¼æ´æˆ–åŠŸèƒ½é—®é¢˜ï¼Œè¯·ç«‹å³ä¿®å¤å¹¶é‡æ–°æµ‹è¯•ã€‚
```

---

## ğŸ¯ ç¬¬10è½®æç¤ºè¯ï¼šAPIæ§åˆ¶å™¨å¼€å‘

```
è¯·å¼€å‘å®Œæ•´çš„APIæ§åˆ¶å™¨ï¼Œå®ç°æ‰€æœ‰RBACç³»ç»Ÿçš„RESTfulæ¥å£ã€‚å…·ä½“è¦æ±‚ï¼š

1. **ç”¨æˆ·ç®¡ç†æ§åˆ¶å™¨**ï¼ˆapi/controllers/user_controller.pyï¼‰ï¼š
   ```python
   from fastapi import APIRouter, Depends, HTTPException, Query
   from typing import List, Optional

   router = APIRouter(prefix="/api/v1/users", tags=["ç”¨æˆ·ç®¡ç†"])

   @router.post("/", response_model=UserResponse)
   async def create_user(
       user_data: UserCreateRequest,
       user_service: UserService = Depends(get_user_service),
       current_user: User = Depends(RequirePermissions(["user:create"]))
   ):
       # åˆ›å»ºæ–°ç”¨æˆ·

   @router.get("/{user_id}", response_model=UserResponse)
   async def get_user(
       user_id: int,
       user_service: UserService = Depends(get_user_service),
       current_user: User = Depends(RequirePermissions(["user:read"]))
   ):
       # è·å–ç”¨æˆ·è¯¦æƒ…

   @router.put("/{user_id}", response_model=UserResponse)
   async def update_user(
       user_id: int,
       user_data: UserUpdateRequest,
       user_service: UserService = Depends(get_user_service),
       current_user: User = Depends(RequirePermissions(["user:update"]))
   ):
       # æ›´æ–°ç”¨æˆ·ä¿¡æ¯

   @router.delete("/{user_id}")
   async def delete_user(
       user_id: int,
       user_service: UserService = Depends(get_user_service),
       current_user: User = Depends(RequirePermissions(["user:delete"]))
   ):
       # åˆ é™¤ç”¨æˆ·

   @router.get("/", response_model=UserListResponse)
   async def list_users(
       page: int = Query(1, ge=1),
       size: int = Query(20, ge=1, le=100),
       search: Optional[str] = Query(None),
       status: Optional[int] = Query(None),
       user_service: UserService = Depends(get_user_service),
       current_user: User = Depends(RequirePermissions(["user:read"]))
   ):
       # è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆåˆ†é¡µã€æœç´¢ã€è¿‡æ»¤ï¼‰
   ```

2. **è®¤è¯æ§åˆ¶å™¨**ï¼ˆapi/controllers/auth_controller.pyï¼‰ï¼š
   ```python
   router = APIRouter(prefix="/api/v1/auth", tags=["è®¤è¯ç®¡ç†"])

   @router.post("/login", response_model=LoginResponse)
   async def login(
       login_data: LoginRequest,
       auth_service: AuthService = Depends(get_auth_service)
   ):
       # ç”¨æˆ·ç™»å½•

   @router.post("/logout")
   async def logout(
       current_user: User = Depends(get_current_user),
       auth_service: AuthService = Depends(get_auth_service)
   ):
       # ç”¨æˆ·ç™»å‡º

   @router.post("/refresh", response_model=TokenResponse)
   async def refresh_token(
       refresh_data: TokenRefreshRequest,
       auth_service: AuthService = Depends(get_auth_service)
   ):
       # åˆ·æ–°ä»¤ç‰Œ

   @router.get("/me", response_model=UserResponse)
   async def get_current_user_info(
       current_user: User = Depends(get_current_user)
   ):
       # è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

   @router.put("/password")
   async def change_password(
       password_data: PasswordChangeRequest,
       current_user: User = Depends(get_current_user),
       user_service: UserService = Depends(get_user_service)
   ):
       # ä¿®æ”¹å¯†ç 
   ```

3. **è§’è‰²ç®¡ç†æ§åˆ¶å™¨**ï¼ˆapi/controllers/role_controller.pyï¼‰ï¼š
   ```python
   router = APIRouter(prefix="/api/v1/roles", tags=["è§’è‰²ç®¡ç†"])

   @router.post("/", response_model=RoleResponse)
   async def create_role(
       role_data: RoleCreateRequest,
       role_service: RoleService = Depends(get_role_service),
       current_user: User = Depends(RequirePermissions(["role:create"]))
   ):
       # åˆ›å»ºè§’è‰²

   @router.get("/", response_model=List[RoleResponse])
   async def list_roles(
       page: int = Query(1, ge=1),
       size: int = Query(20, ge=1, le=100),
       role_service: RoleService = Depends(get_role_service),
       current_user: User = Depends(RequirePermissions(["role:read"]))
   ):
       # è·å–è§’è‰²åˆ—è¡¨

   @router.post("/{role_id}/permissions")
   async def assign_permissions(
       role_id: int,
       permission_data: RolePermissionAssignRequest,
       role_service: RoleService = Depends(get_role_service),
       current_user: User = Depends(RequirePermissions(["role:manage"]))
   ):
       # åˆ†é…æƒé™ç»™è§’è‰²
   ```

4. **æƒé™ç®¡ç†æ§åˆ¶å™¨**ï¼ˆapi/controllers/permission_controller.pyï¼‰ï¼š
   ```python
   router = APIRouter(prefix="/api/v1/permissions", tags=["æƒé™ç®¡ç†"])

   @router.get("/tree", response_model=List[PermissionTreeResponse])
   async def get_permission_tree(
       resource_type: Optional[str] = Query(None),
       permission_service: PermissionService = Depends(get_permission_service),
       current_user: User = Depends(RequirePermissions(["permission:read"]))
   ):
       # è·å–æƒé™æ ‘ç»“æ„
   ```

5. **å“åº”æ ¼å¼ç»Ÿä¸€**ï¼š
   - æˆåŠŸå“åº”ï¼šç»Ÿä¸€çš„æ•°æ®æ ¼å¼
   - é”™è¯¯å“åº”ï¼šç»Ÿä¸€çš„é”™è¯¯æ ¼å¼
   - åˆ†é¡µå“åº”ï¼šç»Ÿä¸€çš„åˆ†é¡µä¿¡æ¯
   - çŠ¶æ€ç ï¼šéµå¾ªHTTPæ ‡å‡†

6. **å‚æ•°éªŒè¯**ï¼š
   - è·¯å¾„å‚æ•°éªŒè¯
   - æŸ¥è¯¢å‚æ•°éªŒè¯
   - è¯·æ±‚ä½“éªŒè¯
   - æ–‡ä»¶ä¸Šä¼ éªŒè¯

7. **é”™è¯¯å¤„ç†**ï¼š
   - ä¸šåŠ¡é€»è¾‘é”™è¯¯
   - æ•°æ®éªŒè¯é”™è¯¯
   - æƒé™ä¸è¶³é”™è¯¯
   - èµ„æºä¸å­˜åœ¨é”™è¯¯

8. **APIæ–‡æ¡£**ï¼š
   - å®Œæ•´çš„æ¥å£æè¿°
   - å‚æ•°è¯´æ˜å’Œç¤ºä¾‹
   - å“åº”æ ¼å¼è¯´æ˜
   - é”™è¯¯ç è¯´æ˜

è¯·ç¡®ä¿æ‰€æœ‰æ¥å£éƒ½æœ‰å®Œæ•´çš„æƒé™æ§åˆ¶å’Œé”™è¯¯å¤„ç†ã€‚
```

---

## ğŸ” ç¬¬10è½®æ£€æŸ¥æç¤ºè¯

```
è¯·å…¨é¢æ£€æŸ¥APIæ§åˆ¶å™¨çš„åŠŸèƒ½å®Œæ•´æ€§å’Œå®‰å…¨æ€§ï¼š

1. **ç”¨æˆ·ç®¡ç†æ¥å£æµ‹è¯•**ï¼š
   - æµ‹è¯•ç”¨æˆ·åˆ›å»ºï¼šPOST /api/v1/users
   - æµ‹è¯•ç”¨æˆ·æŸ¥è¯¢ï¼šGET /api/v1/users/{id}
   - æµ‹è¯•ç”¨æˆ·æ›´æ–°ï¼šPUT /api/v1/users/{id}
   - æµ‹è¯•ç”¨æˆ·åˆ é™¤ï¼šDELETE /api/v1/users/{id}
   - æµ‹è¯•ç”¨æˆ·åˆ—è¡¨ï¼šGET /api/v1/usersï¼ˆåˆ†é¡µã€æœç´¢ã€è¿‡æ»¤ï¼‰

2. **è®¤è¯æ¥å£æµ‹è¯•**ï¼š
   - æµ‹è¯•ç”¨æˆ·ç™»å½•ï¼šPOST /api/v1/auth/login
   - æµ‹è¯•ç”¨æˆ·ç™»å‡ºï¼šPOST /api/v1/auth/logout
   - æµ‹è¯•ä»¤ç‰Œåˆ·æ–°ï¼šPOST /api/v1/auth/refresh
   - æµ‹è¯•è·å–å½“å‰ç”¨æˆ·ï¼šGET /api/v1/auth/me
   - æµ‹è¯•å¯†ç ä¿®æ”¹ï¼šPUT /api/v1/auth/password

3. **è§’è‰²ç®¡ç†æ¥å£æµ‹è¯•**ï¼š
   - æµ‹è¯•è§’è‰²åˆ›å»ºï¼šPOST /api/v1/roles
   - æµ‹è¯•è§’è‰²åˆ—è¡¨ï¼šGET /api/v1/roles
   - æµ‹è¯•æƒé™åˆ†é…ï¼šPOST /api/v1/roles/{id}/permissions
   - æµ‹è¯•è§’è‰²æ›´æ–°å’Œåˆ é™¤æ¥å£

4. **æƒé™ç®¡ç†æ¥å£æµ‹è¯•**ï¼š
   - æµ‹è¯•æƒé™æ ‘ï¼šGET /api/v1/permissions/tree
   - æµ‹è¯•æƒé™åˆ—è¡¨å’Œè¯¦æƒ…æ¥å£
   - æµ‹è¯•æƒé™åˆ›å»ºå’Œæ›´æ–°æ¥å£

5. **æƒé™æ§åˆ¶æµ‹è¯•**ï¼š
   - æµ‹è¯•æ— æƒé™è®¿é—®çš„æ‹’ç»
   - æµ‹è¯•æƒé™ä¸è¶³çš„é”™è¯¯å“åº”
   - æµ‹è¯•ç®¡ç†å‘˜æƒé™çš„ç‰¹æ®Šå¤„ç†
   - æµ‹è¯•æƒé™ç»§æ‰¿å…³ç³»

6. **å‚æ•°éªŒè¯æµ‹è¯•**ï¼š
   - æµ‹è¯•å¿…å¡«å‚æ•°éªŒè¯
   - æµ‹è¯•å‚æ•°æ ¼å¼éªŒè¯
   - æµ‹è¯•å‚æ•°èŒƒå›´éªŒè¯
   - æµ‹è¯•æ— æ•ˆå‚æ•°çš„é”™è¯¯å“åº”

7. **å“åº”æ ¼å¼æµ‹è¯•**ï¼š
   - æµ‹è¯•æˆåŠŸå“åº”æ ¼å¼
   - æµ‹è¯•é”™è¯¯å“åº”æ ¼å¼
   - æµ‹è¯•åˆ†é¡µå“åº”æ ¼å¼
   - æµ‹è¯•çŠ¶æ€ç æ­£ç¡®æ€§

8. **æ€§èƒ½å’Œå®‰å…¨æµ‹è¯•**ï¼š
   - æµ‹è¯•æ¥å£å“åº”æ—¶é—´
   - æµ‹è¯•å¹¶å‘è®¿é—®æ€§èƒ½
   - æµ‹è¯•SQLæ³¨å…¥é˜²æŠ¤
   - æµ‹è¯•XSSæ”»å‡»é˜²æŠ¤

9. **APIæ–‡æ¡£æµ‹è¯•**ï¼š
   - æ£€æŸ¥Swaggeræ–‡æ¡£ç”Ÿæˆ
   - éªŒè¯æ¥å£æè¿°å®Œæ•´æ€§
   - æµ‹è¯•æ–‡æ¡£ä¸­çš„ç¤ºä¾‹
   - æ£€æŸ¥å‚æ•°å’Œå“åº”è¯´æ˜

10. **é›†æˆæµ‹è¯•**ï¼š
    - æµ‹è¯•å®Œæ•´çš„ä¸šåŠ¡æµç¨‹
    - æµ‹è¯•æœåŠ¡å±‚é›†æˆ
    - æµ‹è¯•æ•°æ®åº“äº‹åŠ¡
    - æµ‹è¯•å¼‚å¸¸å›æ»šæœºåˆ¶

å¦‚æœå‘ç°æ¥å£åŠŸèƒ½ç¼ºé™·æˆ–å®‰å…¨é—®é¢˜ï¼Œè¯·ä¿®å¤å¹¶é‡æ–°æµ‹è¯•ã€‚
```

---

## ğŸ“Š æç¤ºè¯æ–¹æ¡ˆæ€»ç»“

### ğŸ¯ æ–¹æ¡ˆç‰¹ç‚¹

1. **ä»»åŠ¡åˆ’åˆ†åˆç†**ï¼š
   - 10è½®ä¸»è¦æç¤ºè¯ï¼Œæ¯è½®å®Œæˆä¸€ä¸ªå®Œæ•´åŠŸèƒ½æ¨¡å—
   - ä»»åŠ¡é‡é€‚ä¸­ï¼Œæ—¢ä¸è¿‡äºç®€å•ä¹Ÿä¸è¿‡äºå¤æ‚
   - æ¯è½®ä»»åŠ¡éƒ½æœ‰æ˜ç¡®çš„äº¤ä»˜æˆæœ

2. **æ£€æŸ¥æœºåˆ¶å®Œå–„**ï¼š
   - æ¯è½®ä¸»è¦æç¤ºè¯åéƒ½æœ‰å¯¹åº”çš„æ£€æŸ¥æç¤ºè¯
   - æ£€æŸ¥å†…å®¹å…¨é¢ï¼Œæ¶µç›–åŠŸèƒ½ã€æ€§èƒ½ã€å®‰å…¨ç­‰æ–¹é¢
   - ç¡®ä¿æ¯ä¸ªé˜¶æ®µçš„è´¨é‡ï¼Œé¿å…é—®é¢˜ç´¯ç§¯

3. **æ–‡ä»¶åˆ†åŒºæ¸…æ™°**ï¼š
   - æ˜ç¡®æŒ‡å®šæ¯ä¸ªåŠŸèƒ½åœ¨å“ªä¸ªæ–‡ä»¶ä¸­å®ç°
   - è¯¦ç»†çš„ç›®å½•ç»“æ„å’Œæ–‡ä»¶ç»„ç»‡
   - æ¸…æ™°çš„æ¨¡å—èŒè´£åˆ’åˆ†

4. **ä»»åŠ¡æè¿°è¯¦ç»†**ï¼š
   - æ¯ä¸ªä»»åŠ¡éƒ½æœ‰å…·ä½“çš„å®ç°è¦æ±‚
   - åŒ…å«ä»£ç ç¤ºä¾‹å’Œç»“æ„è¯´æ˜
   - æ˜ç¡®çš„éªŒæ”¶æ ‡å‡†å’Œè´¨é‡è¦æ±‚

### ğŸ“… æ‰§è¡Œæ—¶é—´è§„åˆ’

| è½®æ¬¡ | ä¸»è¦ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | ç´¯è®¡æ—¶é—´ |
|------|----------|----------|----------|
| 1 | ç¯å¢ƒå‡†å¤‡ä¸åŸºç¡€æ¶æ„ | 0.5å¤© | 0.5å¤© |
| 2 | åŸºç¡€æœåŠ¡ç±»å¼€å‘ | 0.5å¤© | 1å¤© |
| 3 | ç”¨æˆ·ä¸šåŠ¡æœåŠ¡å¼€å‘ | 0.5å¤© | 1.5å¤© |
| 4 | è§’è‰²ä¸šåŠ¡æœåŠ¡å¼€å‘ | 0.5å¤© | 2å¤© |
| 5 | æƒé™ä¸šåŠ¡æœåŠ¡å¼€å‘ | 0.5å¤© | 2.5å¤© |
| 6 | è®¤è¯ä¸šåŠ¡æœåŠ¡å¼€å‘ | 0.5å¤© | 3å¤© |
| 7 | FastAPIåº”ç”¨åŸºç¡€å¼€å‘ | 0.5å¤© | 3.5å¤© |
| 8 | æ•°æ®æ¨¡å¼å®šä¹‰å¼€å‘ | 0.5å¤© | 4å¤© |
| 9 | è®¤è¯ä¸­é—´ä»¶å¼€å‘ | 0.5å¤© | 4.5å¤© |
| 10 | APIæ§åˆ¶å™¨å¼€å‘ | 1å¤© | 5.5å¤© |

**æ€»è®¡**ï¼š5.5å¤©ï¼ˆä¸åŒ…æ‹¬æœ€ç»ˆé›†æˆæµ‹è¯•å’Œæ–‡æ¡£æ•´ç†ï¼‰

### ğŸ”§ æŠ€æœ¯è¦ç‚¹

1. **å……åˆ†åˆ©ç”¨ç°æœ‰åŸºç¡€**ï¼š
   - åŸºäºå®Œæ•´çš„ORMå±‚å’ŒDAOå±‚
   - ä½¿ç”¨ç°æœ‰çš„å·¥å…·ç±»å’Œé…ç½®
   - æ‰©å±•ç°æœ‰çš„æµ‹è¯•æ¡†æ¶

2. **ç°ä»£æŠ€æœ¯æ ˆ**ï¼š
   - FastAPIï¼šé«˜æ€§èƒ½Webæ¡†æ¶
   - Pydanticï¼šæ•°æ®éªŒè¯å’Œåºåˆ—åŒ–
   - JWTï¼šæ— çŠ¶æ€è®¤è¯æœºåˆ¶
   - SQLAlchemy 2.0+ï¼šç°ä»£ORM

3. **å®‰å…¨æœºåˆ¶å®Œå–„**ï¼š
   - JWTä»¤ç‰Œè®¤è¯
   - æƒé™æ£€æŸ¥ä¸­é—´ä»¶
   - æ•°æ®éªŒè¯å’Œè¿‡æ»¤
   - å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•

4. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - ç¼“å­˜æœºåˆ¶
   - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
   - å¼‚æ­¥å¤„ç†
   - åˆ†é¡µå’Œè¿‡æ»¤

### ğŸ¯ è´¨é‡ä¿è¯

1. **ä»£ç è´¨é‡**ï¼š
   - éµå¾ªPEP 8è§„èŒƒ
   - å®Œæ•´çš„ç±»å‹æ³¨è§£
   - è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²
   - ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†

2. **æµ‹è¯•è¦†ç›–**ï¼š
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - APIæµ‹è¯•
   - å®‰å…¨æµ‹è¯•

3. **æ–‡æ¡£å®Œæ•´**ï¼š
   - ä»£ç æ³¨é‡Š
   - APIæ–‡æ¡£ï¼ˆSwaggerï¼‰
   - ä½¿ç”¨è¯´æ˜
   - éƒ¨ç½²æŒ‡å—

### ğŸš€ æˆåŠŸå…³é”®å› ç´ 

1. **ä¸¥æ ¼æŒ‰è½®æ¬¡æ‰§è¡Œ**ï¼šä¸è·³è·ƒï¼Œä¸åˆå¹¶ï¼Œç¡®ä¿æ¯è½®è´¨é‡
2. **é‡è§†æ£€æŸ¥ç¯èŠ‚**ï¼šæ¯è½®éƒ½è¦æ‰§è¡Œæ£€æŸ¥æç¤ºè¯
3. **åŠæ—¶ä¿®å¤é—®é¢˜**ï¼šå‘ç°é—®é¢˜ç«‹å³ä¿®å¤ï¼Œä¸ç•™æŠ€æœ¯å€ºåŠ¡
4. **ä¿æŒæ¶æ„ä¸€è‡´**ï¼šéµå¾ªç°æœ‰çš„è®¾è®¡æ¨¡å¼å’Œè§„èŒƒ

### ğŸ“‹ æœ€ç»ˆäº¤ä»˜æ¸…å•

1. **æºä»£ç **ï¼š
   - services/ï¼šä¸šåŠ¡é€»è¾‘å±‚ï¼ˆ5ä¸ªæœåŠ¡ç±»ï¼‰
   - api/ï¼šæ¥å£å±‚ï¼ˆåº”ç”¨ã€æ§åˆ¶å™¨ã€ä¸­é—´ä»¶ã€æ¨¡å¼ï¼‰
   - tests/ï¼šæ‰©å±•æµ‹è¯•ï¼ˆæœåŠ¡æµ‹è¯•ã€APIæµ‹è¯•ï¼‰
   - config/ï¼šé…ç½®æ‰©å±•ï¼ˆAPIé…ç½®ã€JWTé…ç½®ï¼‰

2. **æ–‡æ¡£**ï¼š
   - Swagger APIæ–‡æ¡£æˆªå›¾
   - ä»£ç ä½¿ç”¨è¯´æ˜
   - éƒ¨ç½²å’Œé…ç½®æŒ‡å—
   - æµ‹è¯•æŠ¥å‘Š

3. **æ¼”ç¤ºææ–™**ï¼š
   - åŠŸèƒ½æ¼”ç¤ºæˆªå›¾æˆ–è§†é¢‘
   - æ€§èƒ½æµ‹è¯•ç»“æœ
   - é—®é¢˜è§£å†³è®°å½•

---

**æç¤ºè¯æ–¹æ¡ˆåˆ¶å®šæ—¶é—´**ï¼š2025-07-21
**æ€»æç¤ºè¯è½®æ¬¡**ï¼š10è½®ä¸»è¦ + 10è½®æ£€æŸ¥ = 20è½®
**é¢„è®¡å¼€å‘å‘¨æœŸ**ï¼š5.5-6å¤©
**è´¨é‡ç›®æ ‡**ï¼šä¼ä¸šçº§ã€å¯ç»´æŠ¤ã€å¯æ‰©å±•çš„RBACæƒé™ç³»ç»ŸAPI

ç°åœ¨æˆ‘éœ€è¦ç»§ç»­æ·»åŠ å‰©ä½™çš„æç¤ºè¯è½®æ¬¡ã€‚è®©æˆ‘ç»§ç»­ç¼–è¾‘æ–‡ä»¶ï¼š
