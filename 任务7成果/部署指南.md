# RBACæƒé™ç®¡ç†ç³»ç»Ÿéƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

**ç³»ç»Ÿåç§°**ï¼šRBACæƒé™ç®¡ç†ç³»ç»Ÿ  
**éƒ¨ç½²ç‰ˆæœ¬**ï¼š1.0.0  
**æ›´æ–°æ—¥æœŸ**ï¼š2025-07-22  
**é€‚ç”¨ç¯å¢ƒ**ï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒ  

## ğŸ¯ éƒ¨ç½²å‰å‡†å¤‡

### ç³»ç»Ÿè¦æ±‚

#### ç¡¬ä»¶è¦æ±‚
- **CPU**ï¼š2æ ¸å¿ƒä»¥ä¸Š
- **å†…å­˜**ï¼š4GBä»¥ä¸Š (ç”Ÿäº§ç¯å¢ƒæ¨è8GB+)
- **å­˜å‚¨**ï¼š20GBä»¥ä¸Šå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**ï¼šç¨³å®šçš„ç½‘ç»œè¿æ¥

#### è½¯ä»¶è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**ï¼šLinux (Ubuntu 20.04+ / CentOS 8+)
- **Python**ï¼š3.9+ (æ¨è3.11)
- **æ•°æ®åº“**ï¼šPostgreSQL 14+ / MySQL 8.0+ / SQLite 3.35+
- **Redis**ï¼š6.0+ (å¯é€‰ï¼Œç”¨äºç¼“å­˜)

### ç¯å¢ƒå‡†å¤‡

#### 1. å®‰è£…Pythonç¯å¢ƒ
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3.11 python3.11-venv python3.11-dev

# CentOS/RHEL
sudo dnf install python3.11 python3.11-venv python3.11-devel
```

#### 2. å®‰è£…æ•°æ®åº“ (ä»¥PostgreSQLä¸ºä¾‹)
```bash
# Ubuntu/Debian
sudo apt install postgresql postgresql-contrib

# CentOS/RHEL
sudo dnf install postgresql postgresql-server postgresql-contrib

# åˆå§‹åŒ–æ•°æ®åº“
sudo postgresql-setup --initdb
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

#### 3. åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
```sql
-- è¿æ¥åˆ°PostgreSQL
sudo -u postgres psql

-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE rbac_system;

-- åˆ›å»ºç”¨æˆ·
CREATE USER rbac_user WITH PASSWORD 'your_password';

-- æˆæƒ
GRANT ALL PRIVILEGES ON DATABASE rbac_system TO rbac_user;

-- é€€å‡º
\q
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ–¹å¼ä¸€ï¼šä¼ ç»Ÿéƒ¨ç½²

#### 1. è·å–æºä»£ç 
```bash
# å…‹éš†ä»£ç ä»“åº“ (å‡è®¾ä»£ç å·²ä¸Šä¼ åˆ°Gitä»“åº“)
git clone https://github.com/your-org/rbac-system.git
cd rbac-system

# æˆ–è€…ç›´æ¥ä½¿ç”¨ç°æœ‰ä»£ç 
cd /path/to/sql_database
```

#### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3.11 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate  # Linux/Mac
# æˆ– venv\Scripts\activate  # Windows
```

#### 3. å®‰è£…ä¾èµ–
```bash
# å®‰è£…Pythonä¾èµ–
pip install -r requirements.txt

# å¦‚æœæ²¡æœ‰requirements.txtï¼Œæ‰‹åŠ¨å®‰è£…æ ¸å¿ƒä¾èµ–
pip install fastapi uvicorn sqlalchemy psycopg2-binary pydantic python-jose bcrypt python-multipart
```

#### 4. é…ç½®ç¯å¢ƒå˜é‡
```bash
# åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
```

#### 5. ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹
```bash
# .env æ–‡ä»¶å†…å®¹
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://rbac_user:your_password@localhost:5432/rbac_system

# JWTé…ç½®
JWT_SECRET_KEY=your-super-secret-jwt-key-here
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=15
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# åº”ç”¨é…ç½®
APP_NAME=RBACæƒé™ç®¡ç†ç³»ç»Ÿ
APP_VERSION=1.0.0
DEBUG=False
HOST=0.0.0.0
PORT=8000

# Redisé…ç½® (å¯é€‰)
REDIS_URL=redis://localhost:6379/0

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_FILE=/var/log/rbac-system/app.log
```

#### 6. æ•°æ®åº“åˆå§‹åŒ–
```bash
# åˆ›å»ºæ•°æ®åº“è¡¨
python -c "
from models import Base
from config.database import engine
Base.metadata.create_all(bind=engine)
print('æ•°æ®åº“è¡¨åˆ›å»ºå®Œæˆ')
"

# åˆå§‹åŒ–åŸºç¡€æ•°æ® (å¯é€‰)
python scripts/init_data.py
```

#### 7. å¯åŠ¨åº”ç”¨
```bash
# å¼€å‘ç¯å¢ƒå¯åŠ¨
uvicorn main:app --host 0.0.0.0 --port 8000 --reload

# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
```

### æ–¹å¼äºŒï¼šDockeréƒ¨ç½²

#### 1. åˆ›å»ºDockerfile
```dockerfile
# Dockerfile
FROM python:3.11-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    libpq-dev \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£…Pythonä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 8000

# å¯åŠ¨å‘½ä»¤
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

#### 2. åˆ›å»ºdocker-compose.yml
```yaml
version: '3.8'

services:
  # æ•°æ®åº“æœåŠ¡
  postgres:
    image: postgres:14
    environment:
      POSTGRES_DB: rbac_system
      POSTGRES_USER: rbac_user
      POSTGRES_PASSWORD: your_password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    networks:
      - rbac-network

  # RedisæœåŠ¡ (å¯é€‰)
  redis:
    image: redis:6-alpine
    ports:
      - "6379:6379"
    networks:
      - rbac-network

  # åº”ç”¨æœåŠ¡
  rbac-app:
    build: .
    ports:
      - "8000:8000"
    environment:
      DATABASE_URL: postgresql://rbac_user:your_password@postgres:5432/rbac_system
      REDIS_URL: redis://redis:6379/0
      JWT_SECRET_KEY: your-super-secret-jwt-key-here
    depends_on:
      - postgres
      - redis
    networks:
      - rbac-network
    volumes:
      - ./logs:/app/logs

volumes:
  postgres_data:

networks:
  rbac-network:
    driver: bridge
```

#### 3. Dockeréƒ¨ç½²å‘½ä»¤
```bash
# æ„å»ºå’Œå¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f rbac-app

# åœæ­¢æœåŠ¡
docker-compose down
```

## ğŸ”§ é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®

#### PostgreSQLé…ç½®
```python
# config/database.py
DATABASE_URL = "postgresql://username:password@host:port/database"
```

#### MySQLé…ç½®
```python
# config/database.py
DATABASE_URL = "mysql+pymysql://username:password@host:port/database"
```

#### SQLiteé…ç½®
```python
# config/database.py
DATABASE_URL = "sqlite:///./rbac_system.db"
```

### å®‰å…¨é…ç½®

#### JWTé…ç½®
```python
# config/settings.py
JWT_SECRET_KEY = "your-super-secret-key"  # ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨å¼ºå¯†é’¥
JWT_ALGORITHM = "HS256"
JWT_ACCESS_TOKEN_EXPIRE_MINUTES = 15
JWT_REFRESH_TOKEN_EXPIRE_DAYS = 7
```

#### å¯†ç åŠ å¯†é…ç½®
```python
# utils/password_utils.py
BCRYPT_ROUNDS = 12  # åŠ å¯†è½®æ•°ï¼Œç”Ÿäº§ç¯å¢ƒæ¨è12è½®
```

### æ€§èƒ½é…ç½®

#### æ•°æ®åº“è¿æ¥æ± 
```python
# config/database.py
engine = create_async_engine(
    DATABASE_URL,
    pool_size=20,          # è¿æ¥æ± å¤§å°
    max_overflow=30,       # æœ€å¤§æº¢å‡ºè¿æ¥
    pool_timeout=30,       # è¿æ¥è¶…æ—¶æ—¶é—´
    pool_recycle=3600,     # è¿æ¥å›æ”¶æ—¶é—´
)
```

#### åº”ç”¨æœåŠ¡å™¨é…ç½®
```bash
# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨é…ç½®
uvicorn main:app \
  --host 0.0.0.0 \
  --port 8000 \
  --workers 4 \
  --worker-class uvicorn.workers.UvicornWorker \
  --access-log \
  --error-log
```

## ğŸ” éƒ¨ç½²éªŒè¯

### å¥åº·æ£€æŸ¥
```bash
# æ£€æŸ¥åº”ç”¨çŠ¶æ€
curl http://localhost:8000/health

# æ£€æŸ¥APIæ–‡æ¡£
curl http://localhost:8000/docs

# æ£€æŸ¥APIä¿¡æ¯
curl http://localhost:8000/api/info
```

### åŠŸèƒ½æµ‹è¯•
```bash
# æµ‹è¯•ç”¨æˆ·æ³¨å†Œ
curl -X POST "http://localhost:8000/api/v1/users" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123",
    "nickname": "æµ‹è¯•ç”¨æˆ·"
  }'

# æµ‹è¯•ç”¨æˆ·ç™»å½•
curl -X POST "http://localhost:8000/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123"
  }'
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—é…ç½®
```python
# config/logging.py
LOGGING_CONFIG = {
    "version": 1,
    "disable_existing_loggers": False,
    "formatters": {
        "default": {
            "format": "%(asctime)s - %(name)s - %(levelname)s - %(message)s",
        },
        "json": {
            "format": '{"timestamp": "%(asctime)s", "level": "%(levelname)s", "message": "%(message)s"}',
        },
    },
    "handlers": {
        "console": {
            "class": "logging.StreamHandler",
            "formatter": "default",
        },
        "file": {
            "class": "logging.FileHandler",
            "filename": "/var/log/rbac-system/app.log",
            "formatter": "json",
        },
    },
    "root": {
        "level": "INFO",
        "handlers": ["console", "file"],
    },
}
```

### æ€§èƒ½ç›‘æ§
```bash
# å®‰è£…ç›‘æ§å·¥å…·
pip install prometheus-client

# æ·»åŠ ç›‘æ§ç«¯ç‚¹
# åœ¨main.pyä¸­æ·»åŠ ç›‘æ§è·¯ç”±
```

## ğŸ”’ å®‰å…¨åŠ å›º

### ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®
```bash
# 1. è®¾ç½®é˜²ç«å¢™
sudo ufw allow 22    # SSH
sudo ufw allow 8000  # åº”ç”¨ç«¯å£
sudo ufw enable

# 2. è®¾ç½®SSLè¯ä¹¦ (ä½¿ç”¨nginxåå‘ä»£ç†)
sudo apt install nginx certbot python3-certbot-nginx

# 3. é…ç½®nginx
sudo nano /etc/nginx/sites-available/rbac-system
```

### Nginxé…ç½®ç¤ºä¾‹
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
sudo systemctl status postgresql

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
psql -h localhost -U rbac_user -d rbac_system
```

#### 2. ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo netstat -tlnp | grep :8000

# æ€æ­»å ç”¨è¿›ç¨‹
sudo kill -9 <PID>
```

#### 3. æƒé™é—®é¢˜
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /path/to/app

# ä¿®æ”¹æƒé™
sudo chown -R app_user:app_group /path/to/app
```

### æ—¥å¿—åˆ†æ
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /var/log/rbac-system/app.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep ERROR /var/log/rbac-system/app.log

# æŸ¥çœ‹è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/access.log
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
```sql
-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_user_username ON users(username);
CREATE INDEX idx_user_email ON users(email);
CREATE INDEX idx_role_code ON roles(role_code);
CREATE INDEX idx_permission_code ON permissions(permission_code);
```

### ç¼“å­˜é…ç½®
```python
# é…ç½®Redisç¼“å­˜
REDIS_CONFIG = {
    "host": "localhost",
    "port": 6379,
    "db": 0,
    "decode_responses": True,
    "max_connections": 20,
}
```

---

**éƒ¨ç½²æ”¯æŒ**ï¼šRBAC System Development Team  
**æŠ€æœ¯æ”¯æŒ**ï¼šsupport@rbac-system.com  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0.0  
**æœ€åæ›´æ–°**ï¼š2025-07-22
